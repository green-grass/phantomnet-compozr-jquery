!function(e,t,o,i){"use strict";function n(t,o,i){if(i=e.extend({childrenOnly:!0,tags:[]},i),e.each(t.children(),function(t,s){n(e(s),o,{childrenOnly:!1,tags:i.tags})}),i.childrenOnly)return t;var s=[];return e.each(t,function(){if(o&&e.inArray(this.tagName.toLowerCase(),i.tags)>-1||!o&&-1===e.inArray(this.tagName.toLowerCase(),i.tags)){var t,n=e(this),a=n.html();n.html("").after(a).remove();try{t=e(a)}catch(r){t=e("")}t.is("*")||(t=n,t.html(a)),s.push(t)}else s.push(this)}),e.apply(e,s)}function s(t,o,i){return i=e.extend({childrenOnly:!0,attrs:[]},i),e.each(t.children(),function(t,n){s(e(n),o,{childrenOnly:!1,attrs:i.attrs})}),i.childrenOnly?t:(e.each(t,function(){var t=e(this),n=[];e.each(this.attributes,function(){this.name&&(o&&e.inArray(this.name,i.attrs)>-1||!o&&-1===e.inArray(this.name,i.attrs))&&n.push(this.name)}),e.each(n,function(e,o){t.removeAttr(o)})}),t)}var a="cleanHtml",r={format:function(){},removeTags:function(e){return n(this,!0,e)},filterTags:function(e){return n(this,!1,e)},removeAttrs:function(e){return s(this,!0,e)},filterAttrs:function(e){return s(this,!1,e)}};e.fn[a]=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery."+a):r.format.apply(this,arguments)}}(jQuery,window,document),function(e,t,o,i){"use strict";var n="colorPicker",s="gg."+n,a="."+s,r="color-picker",l=null,c=function(t,o){this.$element=e(t),this.options=e.extend({},e.fn[n].defaults,o),this.init()};c.prototype.init=function(){this.$element.addClass(r),l=this.$element.html();var t=this,o=e("<ul></ul>");this.$element.append(o),e.each(this.options.colors,function(i,n){var r=e("<li></li>").data(s+".color",n);t.options.formatItem(r,n),o.append(r),r.on("click"+a,function(){t.$element.trigger("select."+s,e(this).data(s+".color"))})})},c.prototype.destroy=function(){this.$element.html(l).removeClass(r),l=null};var d=e.fn[n];e.fn[n]=function(t){return this.each(function(){var o=e(this),i=o.data(s),n="object"==typeof t&&t;(i||"destroy"!==t)&&(i||o.data(s,i=new c(this,n)),"string"==typeof t&&i[t]())})},e.fn[n].defaults={colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],formatItem:function(e,t){e.css("background",t)}},e.fn[n].noConflict=function(){return e.fn[n]=d,this}}(jQuery,window,document),function(e,t,o){"use strict";if(e.GG===o){e.GG={};var i=e.GG;i.namespace=function(){var t,o,i,n=arguments,s=null;for(t=0;t<n.length;t++)for(i=n[t].split("."),s=e,o=0;o<i.length;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];return s};var n=!1,s=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,a=function(){};a.extend=function(e){function t(){!n&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;n=!0;var i=new this;n=!1;for(var r in e)i[r]="function"==typeof e[r]&&"function"==typeof o[r]&&s.test(e[r])?function(e,t){return function(){var i=this._super;this._super=o[e];var n=t.apply(this,arguments);return this._super=i,n}}(r,e[r]):e[r];return t.prototype=i,t.prototype.constructor=t,t.extend=a.extend,t},i.Class=a}}(window,document),function(e,t,o,i){"use strict";t.GG===i&&(t.GG=function(){});var n=t.GG;if(n.Globalization===i){var s="",a=n.Class.extend({getCurrentCulture:function(){return s},setCurrentCulture:function(t){switch(s=t,t){case"vi":e.validator.addMethod("date",function(e,t){return!0}),e.validator.addMethod("number",function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:.\d{3})+)?(?:\,\d+)?$/.test(e)});break;default:if(""==s)return;e.validator.addMethod("date",function(e,t){return this.optional(t)||!/Invalid|NaN/.test(new Date(e).toString())}),e.validator.addMethod("number",function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)})}}});n.Globalization=new a,n.showErrorMessages=function(e){alert(e)};var r="áàảãạăắằẳẵặâấầẩẫậéèẻẽẹêếềểễệíìỉĩịóòỏõọôốồổỗộơớờởỡợúùủũụưứừửữựýỳỷỹỵÁÀẢÃẠĂẮẰẲẴẶÂẤẦẨẪẬÉÈẺẼẸÊẾỀỂỄỆÍÌỈĨỊÓÒỎÕỌÔỐỒỔỖỘƠỚỜỞỠỢÚÙỦŨỤƯỨỪỬỮỰÝỲỶỸỴđĐ",l="aaaaaaaaaaaaaaaaaeeeeeeeeeeeiiiiiooooooooooooooooouuuuuuuuuuuyyyyyAAAAAAAAAAAAAAAAAEEEEEEEEEEEIIIIIOOOOOOOOOOOOOOOOOUUUUUUUUUUUYYYYYdD";n.toAscii=function(e){for(var t=0;t<r.length;t++){var o=new RegExp(r.substr(t,1),"g");e=e.replace(o,l.substr(t,1))}return e},n.outerHtml=function(t){return e("<div></div>").append(e(t).clone()).html()},n.textWithLineBreaks=function(t){for(var o="_______break_______",i=t.replace(/<br\s?\/?>/gi,o).replace(/<p\.*?>(.*?)<\/p>/gi,o+"$1"+o).replace(/<div\.*?>(.*?)<\/div>/gi,o+"$1"+o).replace(/<li\.*?>(.*?)<\/li>/gi,o+"$1"+o),n=e("<div></div>").html(i).text().replace(/\n/g,"").replace(new RegExp(o,"g"),"\n");n.indexOf("\n\n")>-1;)n=n.replace("\n\n","\n");return n},n.escapeHtmlWithLineBreaks=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")},n.toUrlFriendly=function(e){for(e=n.toAscii(e).trim().toLowerCase(),e=e.replace(/ /g,"-"),e=e.replace(/&nbsp;/g,"-"),e=e.replace(/[^0-9a-z-]/g,"");e.indexOf("--")>-1;)e=e.replace(/--/g,"-");return e},n.pasteHtmlAtCaret=function(e){var i,n;if(t.getSelection){if(i=t.getSelection(),i.getRangeAt&&i.rangeCount){n=i.getRangeAt(0),n.deleteContents();var s=o.createElement("div");s.innerHTML=e;for(var a,r,l=o.createDocumentFragment();a=s.firstChild;)r=l.appendChild(a);n.insertNode(l),r&&(n=n.cloneRange(),n.setStartAfter(r),n.collapse(!0),i.removeAllRanges(),i.addRange(n))}}else o.selection&&"Control"!==o.selection.type&&o.selection.createRange().pasteHTML(e)},n.tableToExcel=function(e,o){function i(e){return t.btoa(unescape(encodeURIComponent(e)))}function n(e,t){return e.replace(/{(\w+)}/g,function(e,o){return t[o]})}var s="data:application/vnd.ms-excel;base64,",a='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',r={worksheet:o||"Worksheet",table:e.html()};return s+i(n(a,r))},n.getJSON=function(o,i){return i=e.extend({data:{},onSuccess:function(){},onUnsuccess:function(){},onError:function(){},onComplete:function(){},onUnauthenticated:function(){t.location=t.location}},i),e.getJSON(o,i.data).success(function(e,t,o){e.success===!0?i.onSuccess(e,t,o):e.unauthenticated===!0?i.onUnauthenticated(o,t):i.onUnsuccess(e,t,o)}).error(function(e,t,o){i.onError(e,t,o)!==!1&&n.showErrorMessages([o,e.responseText])}).complete(function(e,t){i.onComplete(e,t)})},n.postJSON=function(o,i){return i=e.extend({data:{},onSuccess:function(){},onUnsuccess:function(){},onError:function(){},onComplete:function(){},onUnauthenticated:function(){t.location=t.location}},i),e.ajax({url:o,type:"POST",data:JSON.stringify(i.data),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e,t,o){e.success===!0||e.Succeeded===!0?i.onSuccess(e,t,o):e.unauthenticated===!0||e.Unauthenticated===!0?i.onUnauthenticated(o,t):i.onUnsuccess(e,t,o),i.onComplete(o,t)},error:function(e,t,o){""===e.responseText?i.onUnauthenticated(e,t):i.onError(e,t,o)!==!1&&n.showErrorMessages([o,e.responseText]),i.onComplete(e,t)}})},n.initDatepickers=function(t,o){function i(t,o){e.each(t,function(t,i){if(!o.yearRange){var n=e(i).attr("data-gg-datepicker-year-range");o.yearRange=n?n:"c-10:c+10"}e(i).datepicker(o)})}Modernizr.inputtypes.date?Modernizr.touch||(t.attr("type","text"),i(t,o)):i(t,o)}}}(jQuery,window,document),$(function(){$("[data-gg-focus]").focus(),GG.initDatepickers($("[data-gg-datepicker]"),{showButtonPanel:!0,changeMonth:!0,changeYear:!0})}),function(){"use strict";function e(){return $("<div></div>").addClass(I).append('<span class="'+A+'"></span>')}function t(){var e,t,o,i,n,s=$("<div></div>").addClass(m),a=$("<div></div>").addClass(h),u=$("<div></div>").addClass(f),C=$("<div></div>").addClass(p).addClass(g),v=$("<span></span>").addClass(L).addClass(r),E=$("<span></span>").addClass(N).addClass(l);return t=$("<button></button>").addClass(k).append('<span class="'+M+'"></span>'),o=$("<button></button>").addClass(O).append('<span class="'+x+'"></span>'),i=$("<button></button>").addClass(H).append('<span class="'+R+'"></span>'),n=$("<div></div>").addClass(G).addClass(c).addClass(d).append($("<div></div>").addClass(b).addClass(y)),e=$("<li></li>").addClass(T).append(C.append(s.append(a.append(i.hide()).append(o).append(t).append(E).append(v))).append(u.append(n)))}function o(e){var t,o,i,n,s=$("<div></div>").addClass(m),a=$("<div></div>").addClass(h),u=$("<div></div>").addClass(f),C=$("<div></div>").addClass(p).addClass(g),v=$("<span></span>").addClass(L).addClass(r),E=$("<span></span>").addClass(N).addClass(l),y=$("<img />").addClass(w).attr("src",e.url).css("display",e.url?"":"none");return o=$("<button></button>").addClass(U).append('<span class="'+F+'"></span>'),i=$("<button></button>").addClass(H).append('<span class="'+R+'"></span>'),n=$("<div></div>").hide().addClass(G).addClass(c).addClass(d).addClass(l).append($("<div></div>").addClass(b).addClass(D).width("100%")),t=$("<li></li>").addClass(T).append(C.append(s.append(a.append(n).append(i).append(o).append(E).append(v))).append(u.append(y)))}function i(e,t){var o=$("."+p,e).removeClass(g).removeClass(C).removeClass(v).removeClass(E);switch(t){case"Normal":o.addClass(g);break;case"Success":o.addClass(C);break;case"Error":o.addClass(v);break;case"Disabled":o.addClass(E)}}function n(e){var t=$("."+p,e);return t.hasClass(g)?"Normal":t.hasClass(C)?"Success":t.hasClass(v)?"Error":t.hasClass(E)?"Disabled":null}function s(e,t){function o(t){function o(){function o(t){e.options.switchItemState(t,"Disabled"),v.css("visibility","hidden"),window.setTimeout(function(){t.fadeOut(e.options.animationDuration,function(){t.remove(),$(e).triggerHandler("filelistitemremove",t)})},e.options.autoClearFileListTimeout)}function i(t){e.options.switchItemState(t,"Error"),C.show(),v.hide()}e.options.switchItemState(h,"Normal"),C.hide(),v.show(),h.data("deleteJqXHR",$.post(e.options.deleteUrl,{fileName:t.fileName},function(e,t,n){n===h.data("deleteJqXHR")&&(h.removeData("deleteJqXHR"),e.success?o(n.item):i(n.item))},"json").error(function(e){i(e.item)})),h.data("deleteJqXHR").item=h}function n(){var t=h.data("fullName"),o=t.substring(0,t.lastIndexOf(".")),i=t.substring(t.lastIndexOf(".")),n=$("<div></div>");e.options.switchItemState(h,"Normal"),n.html(o),f.html("").append(n.attr(V,!0).on("blur"+a,function(e){l($(e.target))}).on("keydown"+a,function(e){switch(e.which){case 27:e.preventDefault(),$(e.target).blur();break;case 13:e.preventDefault(),s($(e.target))}})).after($("<span></span>").addClass(r).html(i)),e.options.urlFriendlyFileName&&n.on("paste"+a,function(e){window.setTimeout(function(){n.html(GG.toUrlFriendly(n.html()))},10)}),n.focus(),!Modernizr.touch&&document.queryCommandEnabled("selectAll")&&document.execCommand("selectAll",!1,null),$(e).triggerHandler("beginEdit",h)}function s(t){t.off(a).blur().removeAttr(V).html(e.options.urlFriendlyFileName?GG.toUrlFriendly(t.html()):t.html()).parent().html(t.text().trim()+t.parent().next().html()).next().remove(),c(),$(e).triggerHandler("comitEdit",h)}function l(o){var i=GG.Components.RemoteFolder.formatFileName(t.fileName,!0);o.off(a).blur().removeAttr(V).parent().html(i).next().remove(),window.setTimeout(function(){e.options.predefinedFileNames.length>0&&!$(":focus").closest("span").is(f)&&g.popover("hide")},100),$(e).triggerHandler("cancelEdit",h)}function c(){function o(o,i){var n=GG.Components.RemoteFolder.formatFileName(i,!0),s=GG.Components.RemoteFolder.formatFileName(i,!1);e.options.switchItemState(o,"Normal"),t.fileName=i,o.data("fullName",s),f.html(n),$(e).triggerHandler("renamesuccess",o)}function i(o,i){if(e.options.switchItemState(o,"Error"),i===!0)C.css("visibility","hidden"),window.setTimeout(function(){o.fadeOut(e.options.animationDuration,function(){o.remove(),$(e).triggerHandler("filelistitemremove",o)})},e.options.autoClearFileListTimeout);else{var n=GG.Components.RemoteFolder.formatFileName(t.fileName,!0);f.html(n)}}e.options.predefinedFileNames.length>0&&g.popover("hide"),e.options.switchItemState(h,"Disabled"),h.data("renameJqXHR",$.post(e.options.renameUrl,{fileName:t.fileName,newName:f.text().trim()},function(e,t,n){n===h.data("renameJqXHR")&&(h.removeData("renameJqXHR"),e.success?o(n.item,e.newFileName):i(n.item,e.fileNotFound))},"json").error(function(e){i(e.item)})),h.data("renameJqXHR").item=h}var d=GG.Components.RemoteFolder.formatFileName(t.fileName,!0),p=GG.Components.RemoteFolder.formatFileName(t.fileName,!1),m=GG.Components.RemoteFolder.formatFileSize(t.fileSize),h=e.options.formatFileListItem(t).data("file",t).data("fullName",p),f=$("."+L,h).html(d),g=($("."+N,h).html(m),$("button."+U.split(" ")[0],h)),C=$("button."+H.split(" ")[0],h),v=$("."+G,h);if(e.options.predefinedFileNames.length>0){var E=$("<ul></ul>").addClass(u);$.each(e.options.predefinedFileNames,function(e,t){E.append($("<li></li>").append($("<a></a>").html(t).on("click"+a,function(e){if(1===e.which){e.preventDefault();var t=h.data("fullName"),o=t.substring(t.lastIndexOf("."));f.html($(e.target).html()+o),c()}})))}),g.popover({html:!0,placement:"top",container:e.container,enabled:!0,content:E})}f.on("click"+a,function(t){$("["+V+"]",t.currentTarget).is("*")||(t.preventDefault(),e.options.predefinedFileNames.length>0&&g.popover("show"),n())}),g.on("click"+a,function(e){e.preventDefault(),n()}),C.on("click"+a,function(e){e.preventDefault(),o()}),e.options.newToTop&&i.length>0?e.fileList.prepend(h):e.fileList.append(h),$(e).triggerHandler("filelistitemadd",h)}var i=e.fileList.children("."+T);$.each(i,function(o,i){var n=$(i),s=n.data("file"),a=!1;s&&s.fileName&&$.each(t,function(e,t){return t.fileName===s.fileName?(n.data("file",t),a=!0,!1):void 0}),a||n.fadeOut(e.options.animationDuration,function(){n.remove(),$(e).triggerHandler("filelistitemremove",n)})}),$.each(t,function(e,t){var n=t.fileName,s=!1;$.each(i,function(e,t){var o=$(t),i=o.data("file");return i&&i.fileName===n?(s=!0,!1):void 0}),s||o(t)}),$(e).triggerHandler("filelistupdate",[t])}GG.namespace("GG.Components");var a=".remote-folder",r="pull-left",l="pull-right",c="progress-striped",d="active",u="list-unstyled",p="panel",m="panel-heading",h="panel-title clearfix",f="panel-body",g="panel-info",C="panel-success",v="panel-danger",E="panel-warning",w="img-responsive img-rounded",G="progress",b="progress-bar",y="progress-bar-info",S="progress-bar-success",D="progress-bar-danger",z="progress-bar-warning",P="remote-folder",T="item",L="file-name",N="file-size",I="btn btn-link btn-lg",A="glyphicon glyphicon-paperclip",_="btn btn-link btn-xs pull-right",k="retry "+_,M="glyphicon glyphicon-refresh",O="cancel "+_,x="glyphicon glyphicon-remove",U="edit "+O,F="glyphicon glyphicon-pencil",H="delete "+O,R="glyphicon glyphicon-trash",B="multiple",V="contenteditable",W=GG.Class.extend({options:{onAdd:function(e){},onUpload:function(e){},onProgress:function(e,t,o){},onComplete:function(e){},onCancel:function(e){},onSuccess:function(e){},onError:function(e){}},init:function(e){this.options=$.extend({},this.options,e)},add:function(e,t){e.is("input")&&(e.after(e.clone(!0)),e.remove())},upload:function(e,t){this.options.onUpload(e)},cancel:function(e){},_handleResponse:function(e,t){e.removeData("uploader"),this.options.onComplete(e),t.success===!0?this.options.onSuccess(e):this.options.onError(e)}}),q=W.extend({add:function(e,t){var o=e.val(),i=t();return i.data("file",e).data("fileName",o).data("fileSize",0/0),this.options.onAdd(i),this._super(e,t),[i]},upload:function(e,t){var o=this,i=(new Date).valueOf(),n=this._createIframe(i,e),s=this._createForm(i,e.data("file"),t);e.data("uploader",n),n.load(function(e){o._handleIframeLoad(e)}),s.submit(),s.remove(),this._super(e)},cancel:function(e){var t=e.data("uploader");t&&(t.attr("src","javascript:false;"),t.remove(),e.removeData("uploader")),this.options.onComplete(e),this.options.onCancel(e)},_createIframe:function(e,t){var o=$("<iframe></iframe>").attr("src","javascript:false;").attr("id",e).attr("name",e).data("item",t).hide();return $(document.documentElement).append(o),o},_createForm:function(e,t,o){var i=$("<form></form>").attr("method","post").attr("enctype","multipart/form-data").attr("action",o).attr("target",e).append(t).hide();return t.attr("name","file"),$(document.documentElement).append(i),i},_handleIframeLoad:function(e){var t,o,i=e.target,n=$(i),s=n.data("item");if(i.parentNode){try{if(i.contentDocument&&i.contentDocument.body&&"false"===i.contentDocument.body.innerHTML)return}catch(e){o={}}if(!o){t=i.contentDocument?i.contentDocument:i.contentWindow.document;try{o=$.parseJSON(t.body.innerHTML)}catch(e){o={}}}n.remove(),this._handleResponse(s,o)}}}),X=W.extend({add:function(e,t){var o=this,i=[];return $.each(e[0].files,function(e,n){var s=n.name||n.fileName,a=n.size||n.fileSize,r=t();r.data("file",n).data("fileName",s).data("fileSize",a),i[e]=r,o.options.onAdd(r)}),this._super(e,t),i},upload:function(e,t,o){function i(){return!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice)}function n(o,i){var l=1048576,c=new XMLHttpRequest,d=a.slice?"slice":a.mozSlice?"mozSlice":a.webkitSlice?"webkitSlice":"slice",u=a[d](i*l,(i+1)*l);e.data("uploader",c),c.upload.addEventListener("progress",function(t){var o=t.lengthComputable?t.loaded:0/0,n=t.lengthComputable?a.size:0/0;o+=i*l,s.options.onProgress(e,o,n)},!1),c.addEventListener("load",function(t){var r;try{r=$.parseJSON(t.target.responseText)}catch(t){r={}}i++,l*i<a.size&&r.success===!0?(e.data("nextPartIndex",i),n(o,i)):s._handleResponse(e,r)},!1),c.addEventListener("abort",function(t){e.removeData("uploader"),s.options.onComplete(e),s.options.onCancel(e)},!1),c.addEventListener("error",function(t){e.removeData("uploader"),s.options.onComplete(e),s.options.onError(e)},!1),c.open("POST",t,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("X-File-ID",encodeURIComponent(o)),c.setRequestHeader("X-File-Name",encodeURIComponent(r)),c.setRequestHeader("X-Part-Index",encodeURIComponent(i)),c.setRequestHeader("X-Part-Count",encodeURIComponent(Math.ceil(a.size/l))),c.setRequestHeader("X-Part-Size",encodeURIComponent(u.size)),c.send(u)}var s=this,a=e.data("file"),r=a.name||a.fileName;if(i()&&!o){var l=e.data("fileId")||Date.now().valueOf()+"-"+r,c=e.data("nextPartIndex")||0;e.data("fileId",l),n(l,c)}else{var d=new XMLHttpRequest,u=new FormData;e.data("uploader",d),u.append("file",a),d.upload.addEventListener("progress",function(t){var o=t.lengthComputable?t.loaded:0/0,i=t.lengthComputable?t.total:0/0;s.options.onProgress(e,o,i)},!1),d.addEventListener("load",function(t){var o;try{o=$.parseJSON(t.target.responseText)}catch(t){o={}}s._handleResponse(e,o)},!1),d.addEventListener("abort",function(t){e.removeData("uploader"),s.options.onComplete(e),s.options.onCancel(e)},!1),d.addEventListener("error",function(t){e.removeData("uploader"),s.options.onComplete(e),s.options.onError(e)},!1),d.open("POST",t,!0),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("X-File-Name",encodeURIComponent(r)),d.send(u)}this._super(e)},cancel:function(e){var t=e.data("uploader");t?t.abort():(this.options.onComplete(e),this.options.onCancel(e))}});GG.Components.RemoteFolder=GG.Class.extend({container:$(),options:{listUrl:null,uploadUrl:null,renameUrl:null,deleteUrl:null,animationDuration:"fast",multiple:!0,resume:!1,dragAndDrop:!0,dragAndDropTarget:window,autoRetryUpload:!0,autoRetryUploadTimeout:6e4,autoClearUpload:!0,autoClearUploadTimeout:3e3,autoClearFileListTimeout:500,showSpeed:!1,newToTop:!0,urlFriendlyFileName:!0,predefinedFileNames:[],uploadQueue:null,fileList:null,formatUploadButton:e,formatUploadQueueItem:t,formatFileListItem:o,populateFileList:s,switchItemState:i,getItemState:n},original:null,uploadQueue:$(),uploadHandler:new W,fileList:$(),updateFileListJqXHR:null,init:function(e,t){function o(){function e(){function e(){var e=document.createElement("input");return e.type="file","files"in e}function t(){var e=new XMLHttpRequest;return!!(e&&"upload"in e&&"onprogress"in e.upload)}return e()&&t()}function t(){var e=$('<input type="file" />'),t=n.options.formatUploadButton();return n.container.prepend(t.append(e)),n.options.multiple&&e.attr(B,B),t.css({position:"relative",overflow:"hidden",direction:"ltr"}),e.css({position:"absolute",right:"0",bottom:"0",fontSize:"118px",margin:"0",padding:"0",cursor:"pointer",opacity:"0",filter:"alpha(opacity=0)"}),window.attachEvent&&e.attr("tabIndex","-1"),e}function o(e){var t=GG.Components.RemoteFolder.formatFileName(e.data("fileName"),!0),o=GG.Components.RemoteFolder.formatFileSize(e.data("fileSize")),i=($("."+L,e).html(t),$("."+N,e).html(""===o?"":"0 KB / "+o)),s=$("button."+k.split(" ")[0],e),r=$("button."+O.split(" ")[0],e),l=$("button."+H.split(" ")[0],e),u=$("."+G,e),p=$("."+b,e);e.data("status","added"),s.on("click"+a,function(){switch(e.data("status")){case"added":return;case"uploading":e.data("status","retrying"),n.uploadHandler.cancel(e);break;case"retrying":return;case"completed":e.data("status","retrying"),r.show(),l.hide(),n.options.switchItemState(e,"Normal"),p.removeClass(D).addClass(y);break;default:return}i.html(""===o?"":"0 KB / "+o),s.css("visibility","hidden"),p.width("0%"),u.addClass(c).addClass(d),f()}),r.on("click"+a,function(){n.uploadHandler.cancel(e)}),l.one("click"+a,function(){$("button:visible",e).css("visibility","hidden"),e.fadeOut(n.options.animationDuration,function(){e.remove(),$(n).triggerHandler("queueitemremove",e)})}),isNaN(e.data("fileSize"))&&p.width("100%"),n.uploadQueue.append(e),$(n).triggerHandler("queueitemadd",e)}function s(e){e.data("status","uploading"),n.options.autoRetryUpload&&e.data("progressTimeout",window.setTimeout(function(){$("button."+k.split(" ")[0],e).click()},n.options.autoRetryUploadTimeout)),n.options.showSpeed&&e.data("speedInterval",window.setInterval(function(){var t=e.data("previousLoaded")||0,o=e.data("lastLoaded")||0;e.data("speed",GG.Components.RemoteFolder.formatFileSize((o-t)/2)+"/s | "),e.data("previousLoaded",o)},2e3))}function r(e,t,o){n.options.autoRetryUpload&&window.clearTimeout(e.data("progressTimeout"));var i=e.data("speed")||"",s=i+(isNaN(t)||isNaN(o)?"":GG.Components.RemoteFolder.formatFileSize(t)+" / "+GG.Components.RemoteFolder.formatFileSize(o)),a=$("."+N,e),r=$("."+b,e);e.data("lastLoaded",t),a.html(s),isNaN(t)||isNaN(o)||r.width(100*t/o+"%"),n.options.autoRetryUpload&&e.data("progressTimeout",window.setTimeout(function(){$("button."+k.split(" ")[0],e).click()},n.options.autoRetryUploadTimeout))}function l(e){if(n.options.autoRetryUpload&&window.clearTimeout(e.data("progressTimeout")),n.options.showSpeed&&window.clearInterval(e.data("speedInterval")),"retrying"!==e.data("status")){var t=GG.Components.RemoteFolder.formatFileSize(e.data("fileSize")),o=$("."+G,e),i=$("."+b,e),s=$("."+N,e);e.data("status","completed"),f(),o.removeClass(c).removeClass(d),i.width("100%"),s.html(t)}}function p(e){if("completed"===e.data("status")){var t=$("button."+k.split(" ")[0],e),o=$("button."+O.split(" ")[0],e),i=$("button."+H.split(" ")[0],e),s=$("."+b,e);t.css("visibility","hidden"),g(e),n.options.switchItemState(e,"Disabled"),o.hide(),i.show(),s.removeClass(y).addClass(z)}}function m(e){var t=$("button."+k.split(" ")[0],e),o=$("button."+O.split(" ")[0],e),s=$("."+b,e);g(e),n.options.switchItemState(e,"Success"),t.css("visibility","hidden"),o.css("visibility","hidden"),s.removeClass(y).addClass(S),i()}function h(e){var t=$("button."+O.split(" ")[0],e),o=$("button."+H.split(" ")[0],e),i=$("."+b,e);n.options.switchItemState(e,"Error"),t.hide(),o.show(),i.removeClass(y).addClass(D)}function f(){var e=5,t=e,o=n.uploadQueue.children("."+T),i=[],s=0;$.each(o,function(e,o){var n=$(o);switch(n.data("status")){case"added":t>0&&(i.push(n),t--);break;case"uploading":s++;break;case"retrying":t>0&&(i.push(n),t--);break;case"completed":}});for(var a=0;a<Math.min(i.length,e-s);a++){var r=i[a];n.uploadHandler.upload(r,n.options.uploadUrl,!n.options.resume),$("button."+k.split(" ")[0],r).css("visibility","")}}function g(e){n.options.autoClearUpload&&window.setTimeout(function(){e.fadeOut(n.options.animationDuration,function(){e.remove(),$(n).triggerHandler("queueitemremove",e)})},n.options.autoClearUploadTimeout)}function C(){e()&&$(n.options.dragAndDropTarget).on("dragover dragenter",function(e){e.preventDefault()}).on("dragleave",function(e){e.preventDefault()}).on("drop",function(e){if(e.preventDefault(),null!==e.originalEvent.dataTransfer){var t=e.originalEvent.dataTransfer.files,o=$({files:t});n.uploadHandler.add(o,function(){return n.options.formatUploadQueueItem()}),f()}})}null===n.options.uploadQueue?n.container.append(n.uploadQueue=$("<ul></ul>").addClass(u)):n.uploadQueue=n.options.uploadQueue;var v={onAdd:function(e){o(e)},onUpload:function(e){s(e)},onProgress:function(e,t,o){r(e,t,o)},onComplete:function(e){l(e)},onCancel:function(e){p(e)},onSuccess:function(e){m(e)},onError:function(e){h(e)}};n.uploadHandler=e()?new X(v):new q(v),t().on("change"+a,function(){n.uploadHandler.add($(this),function(){return n.options.formatUploadQueueItem()}),f()}),n.options.dragAndDrop===!0&&C()}function i(){function e(){}n.updateFileListJqXHR=$.getJSON(n.options.listUrl,function(t,o,i){i===n.updateFileListJqXHR&&(n.updateFileListJqXHR=null,t.success?n.options.populateFileList(n,t.items):e())}).error(function(){e()})}this.options=$.extend({},this.options,t),this.container=$(e).addClass(P),this.original=this.container.html();var n=this;o(),null===this.options.fileList?this.container.append(this.fileList=$("<ul></ul>").addClass(u)):this.fileList=this.options.fileList,i()},destroy:function(){var e=this,t=this.uploadQueue.children("."+T),o=this.fileList.children("."+T);$.each(t,function(t,o){e.uploadHandler.cancel($(o))}),this.updateFileListJqXHR=null,$.each(o,function(e,t){$(t).removeData("deleteJqXHR")}),this.container.html(this.original),this.original=null},items:function(){return this.fileList.children("."+T)}}),$.extend(GG.Components.RemoteFolder,{formatFileName:function(e,t){var o=GG.Components.RemoteFolder.getFilename(e);return t&&(o=GG.Components.RemoteFolder.truncateString(o,50,15)),o},getFilename:function(e){return e.replace(/.*(\/|\\)/,"")},truncateString:function(e,t,o){return e.length>t&&(e=e.slice(0,t-o-1)+"..."+e.slice(0-o)),e},formatFileSize:function(e){if(isNaN(e))return"";var t=-1;do e/=1024,t++;while(e>999);return Math.max(e,.1).toFixed(0)+" "+["KB","MB","GB","TB","PB","EB"][t]}})}(),function(e){"use strict";e.fn.select2.locales.vi={formatNoMatches:function(){return"Không tìm thấy mục nào"},formatInputTooShort:function(e,t){var o=t-e.length;return"Vui lòng nhập thêm "+o+" ký tự"},formatInputTooLong:function(e,t){var o=e.length-t;return"Vui lòng xóa bớt "+o+" ký tự"},formatSelectionTooBig:function(e){return"Chỉ có thể chọn được "+e+" mục"},formatLoadMore:function(e){return"Đang tải thêm kết quả..."},formatSearching:function(){return"Đang tìm..."}},e.extend(e.fn.select2.defaults,e.fn.select2.locales.vi)}(jQuery),window.Compozr=function(e,t,o,i){"use strict";function n(){if(N.timeoutId&&(t.clearTimeout(N.timeoutId),N.timeoutId=null),0!==N.length){var e=N[0];(!e.condition||e.condition())&&(N.shift(),e.action()),N.length>0&&(N.timeoutId=t.setTimeout(function(){N.timeoutId=null,n()},100))}}function s(t){e.each(t,function(t,o){var i=e(o).attr(b),n=S.menuWithAlias[i];e.each(n,function(t,o){var i=e(o);i.before(i.clone().addClass(m).removeAttr(b).find("span").parent().empty().append(e("<span></span>").addClass(p)).end().end()),i.is(":visible")?i.hide().prev().show():i.prev().hide()})})}function a(t){e.each(t,function(t,o){var i=e(o).attr(b),n=S.menuWithAlias[i];e.each(n,function(t,o){var i=e(o);i.prev().is(":visible")&&i.show(),i.prev().remove()})})}function r(t){var o=/<style>([.\s\S]*)<\/style>/,i=t.match(o),n=i?i[1]:"",s=n.split("\n"),a="";return e.each(s,function(t,o){""!==e.trim(o)&&(o="."+$+" "+o,a+=o+"\n")}),t=t.replace(o,"<style>\n"+a+"\n</style>")}function l(t){return t=t||e("<div></div>"),t.addClass("progress progress-striped active").append(e("<div></div>").addClass("progress-bar").css({"-moz-transition":"none","-o-transition":"none","-webkit-transition":"none",transition:"none"}).attr({role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}).width("0%").html("0%")),t}function c(t,o,i,n){return t=t||e("<div></div>"),t.addClass("modal fade").append(e("<div></div>").addClass("modal-dialog").append(e("<div></div>").addClass("modal-content").append(e("<div></div>").addClass("modal-header").append(o?e("<button></button>").addClass("close").attr("data-dismiss","modal").attr("aria-hidden","true").html("&times;"):null).append(e("<h4></h4>").addClass("modal-title").html(i))).append(e("<div></div>").addClass("modal-body").append(n)))),t}var d,u=".compozr",p="glyphicon glyphicon-time",m="disabled",h="navbar-fixed-top",f="navbar-fixed-bottom",g="form-control-static",C="alert alert-danger",v="panel panel-danger",E="panel-heading",w="panel-title",G="panel-body",$="compozr-error-messages",b="data-compozr-menu-item",y="data-compozr-menu-item-alias",S={CONTENTEDITABLE:"contenteditable",SINGLE_LINE:"data-compozr-single-line",NO_HTML:"data-compozr-no-html",URL_FRIENDLY:"data-compozr-url-friendly",PROTECTED:"data-compozr-protected",SELECT_ON_FOCUS:"data-compozr-select-on-focus",SELECT_ON_FIRST_FOCUS:"data-compozr-select-on-first-focus",EXCLUDED:"data-compozr-excluded",INCLUDED:"data-compozr-included",UNCENSORED:"data-compozr-uncensored",container:null,menu:null,menuWithAlias:null},D=[S.CONTENTEDITABLE,S.SINGLE_LINE,S.NO_HTML,S.URL_FRIENDLY,S.PROTECTED,S.SELECT_ON_FOCUS,S.SELECT_ON_FIRST_FOCUS,S.EXCLUDED,S.INCLUDED,S.UNCENSORED],z={closeConfirm:null,newError:null,validationError:null,saveError:null,revertConfirm:null,deleteConfirm:null,deleteError:null,unhandledError:null},P=null,T=[],L=null,N=[];return S.init=function(i,n){function s(){var t={};S.menu={},S.menuWithAlias={};var o=e("["+b+"]",S.container).filter("["+y+"]");e.each(o,function(o,i){var n=e(i),s=n.attr(b);t[s]=t[s]?t[s].add(n):n,n.on("click",function(){S.menu[s].click()})}),o=e("["+b+"]",S.container).not("["+y+"]"),e.each(o,function(o,i){var n=e(i),s=n.attr(b);S.menu[s]=n,S.menuWithAlias[s]=n.add(t[s])}),$Compozr.on("dirty"+u,function(e,t){t?S.menuWithAlias.Save.add(S.menuWithAlias.Revert).removeClass(m):S.menuWithAlias.Save.add(S.menuWithAlias.Revert).addClass(m)}),S.menu.Save.on("click"+u,function(){e(this).hasClass(m)||S.saveDoc()}),S.menu.Revert.on("click"+u,function(){e(this).hasClass(m)||S.revertDoc()})}function a(){e(t).on("beforeunload"+u,function(){return S.dirty()?z.closeConfirm:void 0}),Modernizr.touch||e(o).on("keypress"+u,function(t){!t.ctrlKey&&!t.metaKey||t.shiftKey||t.altKey||115!==t.which&&83!==t.which||(t.preventDefault(),e(":focus").blur(),S.menu.Save.click())})}this.container=e(i),P=e("."+$,this.container),z=e.extend(z,n),s(),S.menuWithAlias.Save.add(S.menuWithAlias.Revert).hide(),S.dirty(!1);var r={show:!0,attachEditorEvents:!0};$Compozr.triggerHandler("init",r),r.show&&S.fadeIn(),r.attachEditorEvents&&S.attachEditorEvents(),
a()},S.show=function(){this.container.stop().show()},S.hide=function(){this.container.stop().hide()},S.fadeIn=function(){this.container.stop(!0,!0).hide().fadeIn("slow")},S.fadeOut=function(){this.container.stop(!0,!0).show().fadeOut("slow")},S.dirty=function(e){return e!==!0&&e!==!1?d:(d=e,void $Compozr.triggerHandler("dirty",e))},S.includeAllInputs=function(t){e("input",t).add("textarea",t).add("select",t).add(t.filter("input")).add(t.filter("textarea")).add(t.filter("select")).attr(S.INCLUDED,"")},S.attachEditorEvents=function(o){var n=e("["+S.CONTENTEDITABLE+"]",o).not("["+S.EXCLUDED+"]"),s=n.filter("["+S.SINGLE_LINE+"]"),a=n.filter("["+S.NO_HTML+"]"),r=n.filter("["+S.URL_FRIENDLY+"]"),l=n.filter("["+S.SELECT_ON_FOCUS+"]"),c=n.filter("["+S.SELECT_ON_FIRST_FOCUS+"]"),d=e("input",o).add("textarea",o).add("select",o).filter("["+S.INCLUDED+"]"),p=d.filter("["+S.URL_FRIENDLY+"]"),m=d.filter("["+S.SELECT_ON_FOCUS+"]"),h=d.filter("["+S.SELECT_ON_FIRST_FOCUS+"]");n.off(u),n.on("focus"+u,function(){S.fixSizeViewport();var o=e(this);o.is("["+S.CONTENTEDITABLE+"]")&&(o.is(l)&&t.setTimeout(function(){o.is(":focus")&&!o.is(":empty")&&S.selectAll()},1),o.is(c)&&(t.setTimeout(function(){o.is(":focus")&&!o.is(":empty")&&S.selectAll()},1),c=c.not(o),o.attr(S.SELECT_ON_FIRST_FOCUS,null)),$Compozr.triggerHandler("inputfocus",this))}),n.on("blur"+u,function(){var t=e(this);t.is("["+S.CONTENTEDITABLE+"]")&&!t.is("span")&&($Compozr.triggerHandler("inputblur",this),S.restoreViewport())}),n.on("keydown"+u,function(){var t=e(this);t.data("prevValue",t.html()),$Compozr.triggerHandler("inputkeydown",this)}),n.on("keyup"+u,function(){var t=e(this);t.data("prevValue")!==i&&t.data("prevValue")!==t.html()&&(S.dirty(!0),$Compozr.triggerHandler("inputchange",this)),t.removeData("prevValue"),$Compozr.triggerHandler("inputkeyup",this)}),n.on("paste"+u,function(){var t=e(this);t.is("["+S.UNCENSORED+"]")||t.cleanHtml("removeTags",{tags:["script","iframe"]}),S.dirty(!0),$Compozr.triggerHandler("inputpaste",this)}),n.on("click"+u,function(){$Compozr.triggerHandler("inputclick",this)}),s.on("keydown"+u,function(e){13===e.keyCode&&e.preventDefault()}),s.on("keyup"+u+" paste"+u+" blur"+u,function(o){var i=e(this);t.setTimeout(function(){"keyup"===o.type?i.cleanHtml("filterTags",{tags:["font","span","b","i","u","strong","em","br"]}):i.cleanHtml("filterTags",{tags:["font","span","b","i","u","strong","em"]})},"paste"===o.type?10:0)}),a.on("keyup"+u+" paste"+u+" blur"+u,function(o){var i=e(this);i.find(".rangySelectionBoundary").is("*")||t.setTimeout(function(){i.cleanHtml("filterTags",{tags:["div","p","br"]}),i.cleanHtml("filterAttrs")},"paste"===o.type?10:0)}),r.on("paste"+u+" blur"+u,function(o){var i=e(this);i.find(".rangySelectionBoundary").is("*")||t.setTimeout(function(){i.html(GG.toUrlFriendly(i.html()))},"paste"===o.type?10:0)}),d.off(u),d.on("focus"+u+" select2-focus"+u,function(){S.fixSizeViewport();var o=e(this);o.is(m)&&t.setTimeout(function(){S.selectAll()},1),o.is(h)&&(t.setTimeout(function(){S.selectAll()},1),h=h.not(o),o.attr(S.SELECT_ON_FIRST_FOCUS,null)),$Compozr.triggerHandler("inputfocus",this)}),d.on("blur"+u+" select2-blur"+u,function(){e(this);$Compozr.triggerHandler("inputblur",this),S.restoreViewport()}),d.on("keydown"+u,function(){$Compozr.triggerHandler("inputkeydown",this)}),d.on("keyup"+u,function(){$Compozr.triggerHandler("inputkeyup",this)}),d.on("paste"+u,function(){$Compozr.triggerHandler("inputpaste",this)}),d.on("click"+u,function(){$Compozr.triggerHandler("inputclick",this)}),d.on("change"+u,function(){S.dirty(!0),$Compozr.triggerHandler("inputchange",this)}),p.on("paste"+u+" blur"+u,function(t){var o=e(this);o.val(GG.toUrlFriendly(o.val())),"function"==typeof o.valid&&o.valid()})},S.detachEditorEvents=function(t){e("["+S.CONTENTEDITABLE+"]",t).not("["+S.EXCLUDED+"]").off(u),e("input",t).add("textarea",t).add("select",t).filter("["+S.INCLUDED+"]").off(u)},S.removeEditorAttrs=function(e){return e.cleanHtml("removeAttrs",{attrs:D}),e},S.selectAll=function(){o.queryCommandEnabled("selectAll")&&o.execCommand("selectAll",!1,null)},S.fixSizeViewport=function(){if(Modernizr.touch){var o=e("meta[name=viewport]");o.data("original",o.attr("content")).attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),e("."+h).css({position:"absolute",top:"0px"}),e("."+f).css({position:"static"}),t.setTimeout(function(){e("."+f).css({position:"relative",top:e("body").css("padding-bottom")})},10)}},S.restoreViewport=function(){if(Modernizr.touch){var t=e("meta[name=viewport]");t.attr("content",t.data("original")),e("."+h).css({position:""}),e("."+f).css({position:"",top:""})}},S.addItem=function(e){T.push(e),e.backup(),e.makeEdit()},S.backupAllItems=function(){e.each(T,function(e,t){t.backup()})},S.restoreAllItems=function(){e.each(T,function(e,t){t.restore()})},S.makeEditAllItems=function(){e.each(T,function(e,t){t.makeEdit()})},S.getAllItemsValues=function(){var t={};return e.each(T,function(e,o){t[o.element]=o.val()}),t},S.retrieveBlockText=function(t){for(var o=e.trim(t.html());e(o).is("div")&&!e(o).attr("style");)o=e(o).html();return t.html(o),t.attr("style")&&(t.html(e("<div></div>").attr("style",t.attr("style")).html(o)),o=t.html(),t.removeAttr("style")),o},S.startProgress=function(t,o){var i=l();e(".progress-bar",i).attr("aria-valuemax",t),L=c(null,!1,o,i),L.modal({backdrop:"static",keyboard:!1})},S.increaseProgress=function(t,o){if(L.is("*")){var i=e(".progress-bar",L),n=parseInt(i.attr("aria-valuenow"));S.setProgress(n+t,o)}},S.setProgress=function(t,o){if(L.is("*")){var i=e(".progress-bar",L),n=parseInt(i.attr("aria-valuemax")),s=Math.floor(100*t/n)+"%";i.attr("aria-valuenow",t).width(s).html(s),o&&e(".modal-title",L).html(o)}},S.endProgress=function(){L.on("hidden.bs.modal",function(){e(this).remove()}),L.modal("hide"),L=e()},S.queueTask=function(e,t,o){N.push({name:e,action:t,condition:o}),n()},S.cancelTask=function(e){N.timeoutId&&(t.clearTimeout(N.timeoutId),N.timeoutId=null);for(var o=0;o<N.length;o++)N[o].name===e&&(N.splice(o,1),o--);n()},S.newDoc=function(){(!S.dirty()||t.confirm(z.closeConfirm))&&$Compozr.triggerHandler("newDoc")},S.saveDoc=function(){S.clearErrorMessages(),$Compozr.triggerHandler("saveDoc")},S.revertDoc=function(){t.confirm(z.revertConfirm)&&(S.clearErrorMessages(),S.dirty(!1),$Compozr.triggerHandler("revertDoc"),S.restoreAllItems(),S.makeEditAllItems(),S.attachEditorEvents())},S.deleteDoc=function(){t.confirm(z.deleteConfirm)&&$Compozr.triggerHandler("deleteDoc")},S.postNew=function(e,o,i,n){return o&&s(o),S.postJSON(e,{data:i,onSuccess:function(e,o,i){n&&n(e,o,i)===!1||e.redirectUrl&&(S.dirty(!1),t.location=e.redirectUrl)},onUnsuccess:function(e){S.showErrorMessages(z.newError,e.messages),o&&a(o)}})},S.postSave=function(t,o,i,n){return o&&e.each(o,function(t,o){s(e(o))}),S.postJSON(t,{data:i,onSuccess:function(e,t,o){n&&n(e,t,o)===!1||(S.backupAllItems(),S.dirty(!1))},onUnsuccess:function(e){S.dirty(!0),S.showSaveErrorMessages(e)},onComplete:function(){o&&o&&e.each(o,function(t,o){a(e(o))})}})},S.postDelete=function(e,o,i){return o&&s(o),S.postJSON(e,{onSuccess:function(e,o,n){if(!i||i(e,o,n)!==!1){var s=e.backUrl||e.ExtraInfo.backUrl;s&&(S.dirty(!1),t.location=s)}},onUnsuccess:function(e){S.showErrorMessages(z.deleteError,e.messages)},onComplete:function(){o&&a(o)}})},S.getJSON=function(t,o){return o=e.extend({onError:function(e,t,o){return S.showErrorMessages(z.unhandledError,[o,r(e.responseText)]),!1}},o),GG.getJSON(t,o)},S.postJSON=function(t,o){return o=e.extend({onError:function(e,t,o){return S.showErrorMessages(z.unhandledError,[o,r(e.responseText)]),!1}},o),GG.postJSON(t,o)},S.showErrorMessages=function(o,i){if(P.data("fadeTimeoutId")&&(t.clearTimeout(P.data("fadeTimeoutId")),P.removeData("fadeTimeoutId")),P.html(""),i&&i.length>0){var n,s,a,r=e("<div></div>").addClass(v).append(e("<div></div>").addClass(E).append(n=e("<h1></h1>").addClass(w))).append(s=e("<div></div>").addClass(G).append(a=e("<ul></ul>")));n.html(o),e.each(i,function(t,o){"object"==typeof o?o.Errors&&e.each(o.Errors,function(t,o){a.append(e("<li></li>").html(o))}):a.append(e("<li></li>").html(o))}),P.append(r)}else{var l=e("<div></div>").addClass(C).html(o);P.append(l)}P.fadeIn("fast"),P.data("fadeTimeoutId",t.setTimeout(function(){P.removeData("fadeTimeoutId"),S.clearErrorMessages()},1e4))},S.showSaveErrorMessages=function(e){S.showErrorMessages(0===e.messages.length?z.saveError:z.validationError,e.messages)},S.clearErrorMessages=function(){P.data("fadeTimeoutId")&&(t.clearTimeout(P.data("fadeTimeoutId")),P.removeData("fadeTimeoutId")),P.fadeOut("fast").html("")},S.ItemBase=GG.Class.extend({element:e(),backup:function(){this.element.data("original",this.element.html())},restore:function(){this.element.html(this.element.data("original"))},makeEdit:function(){this.element.attr(S.CONTENTEDITABLE,"true")},init:function(t){this.element=t.jQuery?t:e(t)},val:function(){var t=this.element.clone();return e("["+S.PROTECTED+"]",t).each(function(t,o){var i=e(o);i.html(i.attr(S.PROTECTED))}),S.removeEditorAttrs(t).html()}}),S.TextBlock=S.ItemBase.extend({val:function(){return S.retrieveBlockText(this.element)}}),S.DataForm=S.ItemBase.extend({makeEdit:function(){this.element.find("h1").attr(S.CONTENTEDITABLE,"true"),this.element.find("."+g).not("["+S.PROTECTED+"]").attr(S.CONTENTEDITABLE,"true")}}),S}(jQuery,window,document),window.$Compozr=$(Compozr),function(){"use strict";var e=".compozr-toolbar",t="disabled",o="dropdown",i="dropdown-toggle",n="open",s="data-compozr-toolbar-item",a="data-compozr-command-value";Compozr.ToolbarBase=GG.Class.extend({container:$(),resources:null,field:null,selection:null,refreshLock:0,init:function(t,o){if(this.container=$(t),this.container.is("*")){this.resources=$.extend(this.resources,o);var i=this;$Compozr.on("inputfocus"+e+" inputblur"+e+" inputkeydown"+e+" inputkeyup"+e+" inputpaste"+e+" inputclick"+e,function(e){0===i.refreshLock&&(i.refreshLock++,window.setTimeout(function(){i.refreshLock--,i.refresh()},500))}),this.attachEvents(this.container),this.refresh()}},attachEvents:function(t){var o=this,i=t.is("["+s+"]")?t:$("["+s+"]",t);i.off("mousedown"+e).off("mouseup"+e).on("mousedown"+e,function(e){1===e.which&&o.onItemMouseDown()}).on("mouseup"+e,function(e){1===e.which&&o.onItemMouseUp($(this))})},onItemMouseDown:function(){if(this.isFieldSupported($(":focus"))){if(this.field=$(":focus"),!this.field.is("*"))return this.field=null,void(this.selection=null);var t=this;this.selection=rangy.saveSelection(),Modernizr.touch||$(document).on("mouseup"+e,function(o){$(this).off("mouseup"+e),1===o.which&&t.restoreSelection()})}},onItemMouseUp:function(o){if(Modernizr.touch||$(document).off("mouseup"+e),o.hasClass(t))return void this.restoreSelection(this.field);var i;o.attr(a)&&(i=o.attr(a)),o.data("getCommandValue")&&(i=o.data("getCommandValue").call(o)),this.execCommand(this.field,o,i),this.field=null},refresh:function(){var e=this,a=$(":focus");this.refreshLock++,window.setTimeout(function(){$.each($("["+s+"]",e.container),function(r,l){var c=$(l),d=c.attr(s),u=!1;if(e.isFieldSupported(a)&&document.queryCommandSupported(d)&&document.queryCommandEnabled(d)&&(u=!0),c.data("queryCommandEnabled")&&c.data("queryCommandEnabled").call(c,a,d)&&(u=!0),u?c.removeClass(t):c.addClass(t),c.hasClass(o)){var p=$("."+i,c);u?p.removeClass(t):(c.hasClass(n)&&c.removeClass(n),p.addClass(t))}}),e.refreshLock--},1)},execCommand:function(e,t,o){this.restoreSelection(e);var i=t.attr(s);t.data("commandFunction")?t.data("commandFunction").call(t,e,i,o):document.queryCommandEnabled(i)&&(document.execCommand(i,!1,o),Compozr.dirty(!0))},restoreSelection:function(e){if(e=e||this.field,null!==e&&e.is("*")&&(e.focus(),this.selection))try{rangy.restoreSelection(this.selection),this.selection=null}catch(t){}},isFieldSupported:function(e){return e.is("["+Compozr.CONTENTEDITABLE+"]")&&!e.is("["+Compozr.EXCLUDED+"]")&&!e.is("["+Compozr.NO_HTML+"]")}})}(),function(){"use strict";var e=".compozr-toolbar",t="disabled",o="data-compozr-toolbar-item",i="data-compozr-root-item",n="popover";Compozr.HtmlEditorToolbar=Compozr.ToolbarBase.extend({resources:{pasteDescription:"Paste text from any source here to remove all formatting.",createLinkPrompt:"Url:"},init:function(t,s){function a(){var t=$("<textarea></textarea>"),s=$("["+o+"=paste]",l.container),a=$("<div></div>"),r=$("["+o+"=forecolor]",l.container),c=$("["+o+"=createlink]",l.container),d=$("["+o+"=youtube]",l.container),u=$("["+o+"=aside]",l.container);t.css({width:"100%",height:"200px"}),s.data("queryCommandEnabled",function(e,t){return s.next().hasClass(n)||l.isFieldSupported(e)}).data("commandFunction",function(e,t,o){GG.pasteHtmlAtCaret(o),Compozr.dirty(!0)}).popover({html:!0,placement:"bottom",title:l.resources.pasteDescription,enabled:!1,content:t}).on("shown.bs.popover"+e,function(){t.one("paste"+e,function(e){window.setTimeout(function(){for(var e=t.val();e.indexOf("\r\n")>0;)e=e.replace(/\r\n/g,"\n");for(;e.indexOf("\n\n")>0;)e=e.replace(/\n\n/g,"\n");l.execCommand(l.field,s,GG.escapeHtmlWithLineBreaks(e))},10)}).one("blur"+e,function(){s.popover("hide")}).focus()}).on("hide.bs.popover"+e,function(){l.restoreSelection(),l.field=null}).on("hidden.bs.popover"+e,function(){t.val(null)}).off("mousedown"+e).on("mousedown"+e,function(){return t.is(":focus")?void t.off("blur"+e):void l.onItemMouseDown()}).off("mouseup"+e).on("mouseup"+e,function(){Modernizr.touch||$(document).off("mouseup"+e)}),a.colorPicker({formatItem:function(e,t){e.css("background",t).attr(o,"forecolor").data("getCommandValue",function(){return t})}}),l.attachEvents(a),r.attr(i,"").data("commandFunction",function(e,t,o){}).popover({html:!0,placement:"bottom",content:a}).on("shown.bs.popover"+e,function(){$Compozr.on("inputfocus"+e+"-foreColor",function(){r.popover("hide")}),$(document).on("click"+e+"-foreColor",function(){r.popover("hide")})}).on("hidden.bs.popover"+e,function(){$Compozr.off("inputfocus"+e+"-foreColor"),$(document).off("click"+e+"-foreColor")}),c.data("getCommandValue",function(){return window.prompt(l.resources.createLinkPrompt,"http://")}),d.data("queryCommandEnabled",function(e,t){return l.isFieldSupported(e)}).data("getCommandValue",function(){return window.prompt("YouTube","")}).data("commandFunction",function(e,t,o){o=o.substr(o.lastIndexOf("=")+1),o=o.substr(o.lastIndexOf("/")+1),GG.pasteHtmlAtCaret("[youtube]"+o+"[/youtube]"),Compozr.dirty(!0)}),u.data("queryCommandEnabled",function(e,t){return l.isFieldSupported(e)}).data("commandFunction",function(e,t,o){GG.pasteHtmlAtCaret('[aside]<span class="html-editor-toolbar-caret"></span>'),$(".html-editor-toolbar-caret",e).after("[/aside]").remove(),Compozr.dirty(!0)})}function r(){function t(e){$("["+o+"="+e+"]",l.container).trigger({type:"mousedown",which:1}).trigger({type:"mouseup",which:1})}Modernizr.touch||$(document).on("keypress"+e,function(e){if((e.ctrlKey||e.metaKey)&&!e.shiftKey&&!e.altKey)switch(e.which){case 66:case 98:e.preventDefault(),t("bold");break;case 73:case 105:e.preventDefault(),t("italic");break;case 85:case 117:e.preventDefault(),t("underline")}})}if(this._super(t,s),this.container.is("*")){var l=this;a(),r()}},show:function(){$("["+o+"]",this.container).show()},hide:function(){$("["+o+"]",this.container).hide()},refresh:function(){this._super();var e=this,n=$("["+o+"=paste]",this.container),s=$("["+o+"=forecolor]["+i+"]",this.container);Compozr.queueTask("finishRefresh",function(){n.popover(n.hasClass(t)?"disable":"enable"),s.popover(s.hasClass(t)?"disable":"enable")},function(){return 0===e.refreshLock})},execCommand:function(e,t,i){this._super(e,t,i);var n=t.attr(o);"createlink"!==n||!i||0!==i.indexOf("http://")&&0!==i.indexOf("https://")||e.find('a[href="'+i+'"]').attr("target","_blank")}})}(),function(){"use strict";var e="disabled",t="data-compozr-toolbar-item",o="note";Compozr.HtmlImageToolbar=Compozr.ToolbarBase.extend({resources:{imageCaptionMessage:null},init:function(e,t){if(this._super(e,t),this.container.is("*")){var o=$("*",this.container).filter(function(){return $(this).data("remoteFolder")}).data("remoteFolder"),i=this;null!==o&&($.each(o.items(),function(e,t){i.initItem($("img",t))}),$(o).on("filelistitemadd",function(e,t){i.initItem($("img",t)),i.refresh()}))}},refresh:function(){this._super();var t=this;Compozr.queueTask("finishRefresh",function(){Modernizr.touch||($("img",t.container).hasClass(e)?$("."+o,t.container).hide():$("."+o,t.container).show())},function(){return 0===t.refreshLock})},initItem:function(e){var o=this;e.attr(t,"image").data("queryCommandEnabled",function(e,t){return o.isFieldSupported(e)}).data("getCommandValue",function(){var t=e.closest("li").data("fullName"),i=window.prompt(o.resources.imageCaptionMessage,"");return{name:t,caption:null===i?null:i.trim()}}).data("commandFunction",function(e,t,o){if(null!==o.caption){var i='[image name="'+o.name+'" alt="'+o.caption+'" caption="" description=""][label]'+o.caption+"[/label]";GG.pasteHtmlAtCaret(i),Compozr.dirty(!0)}}),this.attachEvents(e)}})}(),function(){"use strict";GG.namespace("GG.PageCompozr"),GG.PageCompozr.Resources=GG.Class.extend({edit:null,backToPreview:null})}(),function(){"use strict";GG.namespace("GG.PageCompozr"),GG.PageCompozr=$.extend(GG.PageCompozr,{DEFAULT_EVENT_DOMAIN:".page-compozr",PLACE_HOLDER_EVENT_DOMAIN:".page-compozr-place-holder",EXTRA_INFO_CSS_CLASS:"page-compozr-extra-info",PLACE_HOLDER_CSS_CLASS:"place-holder",CLEARFIX_CSS_CLASS:"clearfix",ON_TWO_COLUMN_BREAK_CSS_CLASS:"clearfix visible-sm",ON_THREE_COLUMN_BREAK_CSS_CLASS:"clearfix visible-md visible-lg",COLUMN_CSS_CLASS:"col-sm-6 col-md-4",EXPANDED_COLUMN_CSS_CLASS:"col-sm-6 col-md-8",FULL_COLUMN_CSS_CLASS:"col-sm-12"}),GG.PageCompozr.PageViewOptions=GG.Class.extend({}),GG.PageCompozr.PageView=GG.Class.extend({container:$(),options:new GG.PageCompozr.PageViewOptions,resources:new GG.PageCompozr.Resources,page:$(),extraInfo:$(),hiddenOnEditMode:$(),assignElementsLock:0,preparePageEditorLock:0,cleanupPageEditorLock:0,init:function(e,t,o){this.container=$(e),this.options=$.extend({},this.options,t),this.resources=$.extend({},this.resources,o)},assignElements:function(){this.assignElementsLock++;var e;this.page.append(this.extraInfo=$("<div></div>").hide().addClass(GG.PageCompozr.EXTRA_INFO_CSS_CLASS).append(e=$("<ul></ul>").addClass(GG.PageCompozr.CLEARFIX_CSS_CLASS))),this.assignElementsLock--},preparePageEditor:function(e){this.preparePageEditorLock++,this.extraInfo.show(),this.preparePageEditorLock--},cleanupPageEditor:function(e){this.cleanupPageEditorLock++,this.extraInfo.hide(),this.cleanupPageEditorLock--},initPlaceHolder:function(e,t,o,i){function n(e,t){var n=$.trim(e.html()),s=$("<div></div>").html(n);s.find(".rangySelectionBoundary").is("*")||(s.cleanHtml("filterTags",{tags:["img"]}),""===$.trim(s.html())?(e.addClass(GG.PageCompozr.PLACE_HOLDER_CSS_CLASS+(o?" required":"")).html(t),i&&e.prev().hide()):(e.html(n),i&&e.prev().show()))}var s=this;if(e.length&&e.length>1)$.each(e,function(e,n){s.initPlaceHolder($(n),t,o,i)});else{i&&e.before($("<label></label>").hide().html(t));var a="["+t+"]";n(e,a),e.css("min-height")&&0!==parseInt(e.css("min-height"),10)||e.css("min-height",e.css("line-height")),e.on("focus"+GG.PageCompozr.PLACE_HOLDER_EVENT_DOMAIN,function(){var t=$(this);t.hasClass(GG.PageCompozr.PLACE_HOLDER_CSS_CLASS)&&(t.removeClass(GG.PageCompozr.PLACE_HOLDER_CSS_CLASS).html(""),i&&e.prev().show())}).on("blur"+GG.PageCompozr.PLACE_HOLDER_EVENT_DOMAIN,function(){n($(this),a)})}},destroyPlaceHolder:function(e,t){var o=this;e.length&&e.length>1?$.each(e,function(e,i){o.destroyPlaceHolder($(i),t)}):(e.off(GG.PageCompozr.PLACE_HOLDER_EVENT_DOMAIN),e.css("min-height",""),e.hasClass(GG.PageCompozr.PLACE_HOLDER_CSS_CLASS)&&e.html("").removeClass(GG.PageCompozr.PLACE_HOLDER_CSS_CLASS),t&&e.prev().remove())},setField:function(e,t){e.triggerHandler("focus"),e.html(t),e.triggerHandler("blur")},loadPageModel:function(){return{}},loadField:function(e,t){return e.hasClass(GG.PageCompozr.PLACE_HOLDER_CSS_CLASS)?"":$.trim(t===!0?e.html():e.text())}})}(),function(){"use strict";GG.namespace("GG.PageCompozr"),GG.PageCompozr=$.extend(GG.PageCompozr,{ICON_CSS_CLASS:"glyphicon",EDIT_CSS_CLASS:"glyphicon-edit",PREVIEW_CSS_CLASS:"glyphicon-check"}),GG.PageCompozr.PageModel=GG.Class.extend({}),GG.PageCompozr.PageControllerOptions=GG.Class.extend({contentImagesPath:null,editMode:!1}),GG.PageCompozr.PageController=GG.Class.extend({view:new GG.PageCompozr.PageView,options:new GG.PageCompozr.PageControllerOptions,model:new GG.PageCompozr.PageModel,resources:new GG.PageCompozr.Resources,assignElementsLock:0,enableElementsEditabilityLock:0,disableElementsEditabilityLock:0,shortcutLock:!0,init:function(e,t,o,i){function n(){Modernizr.touch||$(document).on("keypress"+GG.PageCompozr.DEFAULT_EVENT_DOMAIN,function(e){if(!s.shortcutLock&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&!e.altKey)switch(e.which){case 69:case 101:e.preventDefault(),$(":focus").blur(),Compozr.menu.EditPage.click()}})}this.view=$.extend({},this.view,e),this.view.container.data("gg.page-compozr.page-controller",this),this.options=$.extend({},this.options,t),this.model=$.extend({},this.model,o),this.resources=$.extend({},this.resources,i);var s=this;n(),$Compozr.on("init"+GG.PageCompozr.DEFAULT_EVENT_DOMAIN,function(e,t){t.show=!1,t.attachEditorEvents=!1,s.initMenu(),s.assignElements(),Compozr.queueTask("finishInit",function(){s.backupInitialData(),Compozr.fadeIn(),s.shortcutLock=!1,s.options.editMode&&Compozr.menu.EditPage.click()},function(){return 0===s.assignElementsLock})})},initMenu:function(){var e=this;Compozr.menu.EditPage.on("click"+GG.PageCompozr.DEFAULT_EVENT_DOMAIN,function(){e.switchMode()})},switchMode:function(){this.isEditMode()?this.switchToPreviewMode():this.switchToEditMode()},isEditMode:function(){return $("."+GG.PageCompozr.ICON_CSS_CLASS,Compozr.menu.EditPage).hasClass(GG.PageCompozr.PREVIEW_CSS_CLASS)},switchToEditMode:function(){var e=this;this.shortcutLock=!0,Compozr.fadeOut(),$("."+GG.PageCompozr.ICON_CSS_CLASS,Compozr.menuWithAlias.EditPage).removeClass(GG.PageCompozr.EDIT_CSS_CLASS).addClass(GG.PageCompozr.PREVIEW_CSS_CLASS),$("[title]",Compozr.menuWithAlias.EditPage).attr("title",this.resources.backToPreview),this.view.hiddenOnEditMode.hide(),this.view.preparePageEditor(function(t){return e.turnOffContentHtml(t)}),Compozr.queueTask("enableElementsEditability",function(){e.enableElementsEditability()},function(){return 0===e.view.preparePageEditorLock}),Compozr.queueTask("finishSwitchToEditMode",function(){Compozr.attachEditorEvents(),Compozr.fadeIn(),e.shortcutLock=!1,$Compozr.triggerHandler("edit",e.isEditMode())},function(){return 0===e.enableElementsEditabilityLock})},switchToPreviewMode:function(){var e=this;this.shortcutLock=!0,Compozr.fadeOut(),$("."+GG.PageCompozr.ICON_CSS_CLASS,Compozr.menuWithAlias.EditPage).removeClass(GG.PageCompozr.PREVIEW_CSS_CLASS).addClass(GG.PageCompozr.EDIT_CSS_CLASS),$("[title]",Compozr.menuWithAlias.EditPage).attr("title",this.resources.edit),Compozr.detachEditorEvents(),this.disableElementsEditability(),Compozr.queueTask("cleanupPageEditor",function(){e.view.cleanupPageEditor(function(t){return e.turnOnContentHtml(t)})},function(){return 0===e.disableElementsEditabilityLock}),Compozr.queueTask("finishSwitchToPreviewMode",function(){e.view.hiddenOnEditMode.show(),Compozr.fadeIn(),e.shortcutLock=!1,$Compozr.triggerHandler("edit",e.isEditMode())},function(){return 0===e.view.cleanupPageEditorLock})},backupInitialData:function(){},restoreData:function(){},assignElements:function(){this.assignElementsLock++;var e=this;this.view.assignElements(),Compozr.queueTask("finishAssignElements",function(){e.assignElementsLock--},function(){return 0===e.view.assignElementsLock})},enableElementsEditability:function(){},disableElementsEditability:function(){},turnOffContentHtml:function(e){var t=$("<div></div>").html(e),o=t.find("figure");$.each(o,function(e,t){var o=$(t),i=$("img",o),n=$("figcaption",o).html(),s="";if(i.is("*")){var a=i.attr("src"),r=i.attr("alt"),l=i.attr("caption"),c=i.attr("description"),d=a.substring(Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))+1,a.length);r=void 0===r?"":r,l=void 0===l?"":l,c=void 0===c?"":c,s+='[image name="'+d+'" alt="'+r+'" caption="'+l+'" description="'+c+'"]'}n&&(s+="[label]"+n+"[/label]"),o.replaceWith(s)});var i=t.find("iframe");$.each(i,function(e,t){var o,i,n=$(t);n.attr("src")&&0===n.attr("src").indexOf("http://www.youtube.com")&&(o=n.attr("src").substr("http://www.youtube.com/embed/".length,11),i="[youtube]"+o+"[/youtube]",n.replaceWith(i))});var n=t.find("div.aside");return $.each(n,function(e,t){var o=$(t),i="[aside]"+o.html()+"[/aside]";o.replaceWith(i)}),t.html()},turnOnContentHtml:function(e){var t,o,i;for(t=/\[image\s+name\s*=\s*('\s*((\w|\-)+.\w+)\s*'|"\s*((\w|\-)+.\w+)\s*")(\s+alt=\s*('\s*([\s\S]*?)\s*'|"\s*([\s\S]*?)\s*"))*(\s+caption=\s*('\s*([\s\S]*?)\s*'|"\s*([\s\S]*?)\s*"))*(\s+description=\s*('\s*([\s\S]*?)\s*'|"\s*([\s\S]*?)\s*"))*\s*\]/g;null!==(o=t.exec(e));){var n=o[2]?o[2]:o[4],s=o[8]?o[8]:o[9],a=o[12]?o[12]:o[13],r=o[16]?o[16]:o[17],l=this.options.contentImagesPath+"/"+n;i='<figure><img alt="'+s+'" caption="'+a+'" description="'+r+'" src="'+l+'" /></figure>',e=e.replace(o[0],i)}for(t=/\[label\][\s\S]*?\[\/label\]/g;null!==(o=t.exec(e));)i=o[0].replace(/<\/div>\s*<div>/g,"<br />"),e=e.replace(o[0],i);for(e=e.replace(/\[label\]/g,"<figure><figcaption>"),e=e.replace(/\[\/label\]/g,"</figcaption></figure>"),e=e.replace(/<\/figure><figure><figcaption>/g,"<figcaption>"),t=/\[youtube\]([a-zA-Z0-9]{11})\[\/youtube\]/g;null!==(o=t.exec(e));)i='<iframe width="640" height="480" src="http://www.youtube.com/embed/'+o[1]+'?rel=0" frameborder="0" allowfullscreen></iframe>',e=e.replace(o[0],i);return e=e.replace(/\[aside\]/g,'<div class="aside">'),e=e.replace(/\[\/aside\]/g,"</div>")}})}(),function(){"use strict";GG.namespace("GG.PageCompozr.PageImages"),GG.PageCompozr.PageImages.Resources={pageImages:null}}(),function(){"use strict";GG.namespace("GG.PageCompozr.PageImages"),GG.PageCompozr.PageImages=$.extend(GG.PageCompozr.PageImages,{DEFAULT_EVENT_DOMAIN:".page-compozr-page-images",FIXED_BOTTOM_CSS_CLASS:"navbar-fixed-bottom",IMAGES_PANEL_CSS_CLASS:"page-compozr-images-panel",IMAGES_PANEL_TITLE_CSS_CLASS:"text-info",IMAGES_PANEL_REMOTE_FOLDER_CONTAINER_CSS_CLASS:"folder-container",IMAGES_PANEL_UPLOAD_BUTTON_CSS_CLASS:"btn btn-link btn-lg",IMAGES_PANEL_UPLOAD_BUTTON_ICON_CSS_CLASS:"glyphicon glyphicon-plus"}),GG.PageCompozr.PageImages.PageViewOptions={imageListUrl:null,uploadImageUrl:null,renameImageUrl:null,deleteImageUrl:null,predefinedImageFileNames:[]},GG.PageCompozr.PageImages.PageView={options:GG.PageCompozr.PageImages.PageViewOptions,resources:GG.PageCompozr.PageImages.Resources,imagesPanel:$(),assignElements:function(){this.assignElementsLock++,this._super();var e;$("body").append(this.imagesPanel=$("<section></section>")),this.imagesPanel.addClass(GG.PageCompozr.PageImages.FIXED_BOTTOM_CSS_CLASS).addClass(GG.PageCompozr.PageImages.IMAGES_PANEL_CSS_CLASS).hide().append($("<h2></h2>").addClass(GG.PageCompozr.PageImages.IMAGES_PANEL_TITLE_CSS_CLASS).html(this.resources.pageImages)).append($("<div></div>").addClass(GG.PageCompozr.PageImages.IMAGES_PANEL_REMOTE_FOLDER_CONTAINER_CSS_CLASS).append(e=$("<div></div>")));var t={listUrl:this.options.imageListUrl,uploadUrl:this.options.uploadImageUrl,renameUrl:this.options.renameImageUrl,deleteUrl:this.options.deleteImageUrl,predefinedFileNames:this.options.predefinedImageFileNames,formatUploadButton:function(){return $("<div></div>").addClass(GG.PageCompozr.PageImages.IMAGES_PANEL_UPLOAD_BUTTON_CSS_CLASS).append($("<span></span>").addClass(GG.PageCompozr.PageImages.IMAGES_PANEL_UPLOAD_BUTTON_ICON_CSS_CLASS))}},o=new GG.Components.RemoteFolder(e,t);e.data("remoteFolder",o),$(o).on("beginEdit"+GG.PageCompozr.PageImages.DEFAULT_EVENT_DOMAIN,function(e,t){Compozr.fixSizeViewport(),$("["+Compozr.CONTENTEDITABLE+"]",t).attr(Compozr.EXCLUDED,"")}).on("comitEdit"+GG.PageCompozr.PageImages.DEFAULT_EVENT_DOMAIN+" cancelEdit"+GG.PageCompozr.PageImages.DEFAULT_EVENT_DOMAIN,function(){Compozr.restoreViewport()}),this.assignElementsLock--},preparePageEditor:function(e){this.preparePageEditorLock++,this._super(e);var t=this;$("body").css("padding-bottom","+="+(this.imagesPanel.outerHeight()+parseInt(this.imagesPanel.css("margin-bottom")))),Modernizr.touch&&($Compozr.on("inputfocus"+GG.PageCompozr.PageImages.DEFAULT_EVENT_DOMAIN,function(){$("body").css("padding-bottom","-="+(t.imagesPanel.outerHeight()+parseInt(t.imagesPanel.css("margin-bottom"))))}),$Compozr.on("inputblur"+GG.PageCompozr.PageImages.DEFAULT_EVENT_DOMAIN,function(){$("body").css("padding-bottom","+="+(t.imagesPanel.outerHeight()+parseInt(t.imagesPanel.css("margin-bottom"))))})),this.imagesPanel.show(),this.preparePageEditorLock--},cleanupPageEditor:function(e){this.cleanupPageEditorLock++,this._super(e),this.imagesPanel.hide(),$Compozr.off("inputfocus"+GG.PageCompozr.PageImages.DEFAULT_EVENT_DOMAIN+" inputblur"+GG.PageCompozr.PageImages.DEFAULT_EVENT_DOMAIN),$("body").css("padding-bottom","-="+(this.imagesPanel.outerHeight()+parseInt(this.imagesPanel.css("margin-bottom")))),this.cleanupPageEditorLock--}}}(),function(){"use strict";GG.namespace("GG.PageCompozr.PageImages"),GG.PageCompozr.PageImages.PageController={view:GG.PageCompozr.PageImages.PageView,resources:GG.PageCompozr.PageImages.Resources,init:function(e,t,o,i){this._super(e,t,o,i),void 0!==this.model.Id&&null!==this.model.Id&&(this.view.options.imageListUrl+="/"+this.model.Id,this.view.options.uploadImageUrl+="/"+this.model.Id,this.view.options.renameImageUrl+="/"+this.model.Id,this.view.options.deleteImageUrl+="/"+this.model.Id)}}}(),function(){"use strict";GG.namespace("GG.PageCompozr.MultiPage"),GG.PageCompozr.MultiPage.Resources={show:null,hide:null,enablePageMessage:null}}(),function(){"use strict";GG.namespace("GG.PageCompozr.MultiPage"),GG.PageCompozr.MultiPage=$.extend(GG.PageCompozr.MultiPage,{DEFAULT_EVENT_DOMAIN:".page-compozr-multi-page"}),GG.PageCompozr.MultiPage.PageView={resources:GG.PageCompozr.MultiPage.Resources}}(),function(){"use strict";GG.namespace("GG.PageCompozr.MultiPage"),GG.PageCompozr.MultiPage=$.extend(GG.PageCompozr.MultiPage,{ENABLED_CSS_CLASS:"glyphicon-star",DISABLED_CSS_CLASS:"glyphicon-star-empty"}),GG.PageCompozr.MultiPage.PageModel={Id:null,Enabled:null},GG.PageCompozr.MultiPage.PageControllerOptions={newPageUrl:null,savePageUrl:null,togglePageUrl:null,deletePageUrl:null,pageUrl:null,previewAfterSave:!0},GG.PageCompozr.MultiPage.PageController={view:GG.PageCompozr.MultiPage.PageView,options:GG.PageCompozr.MultiPage.PageControllerOptions,model:GG.PageCompozr.MultiPage.PageModel,resources:GG.PageCompozr.MultiPage.Resources,init:function(e,t,o,i){function n(){Modernizr.touch||$(document).on("keypress"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(e){if(!s.shortcutLock&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&!e.altKey)switch(e.which){case 78:case 110:s.isEditMode()||(e.preventDefault(),$(":focus").blur(),Compozr.menu.NewPage.click())}})}this._super(e,t,o,i),this.options.savePageUrl+="/"+this.model.Id,this.options.togglePageUrl+="/"+this.model.Id,this.options.deletePageUrl+="/"+this.model.Id;var s=this;n(),$Compozr.on("newDoc"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(){s.onNewPage()}),$Compozr.on("saveDoc"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(){s.onSavePage()}),$Compozr.on("revertDoc"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(){s.onRevertPage()}),$Compozr.on("deleteDoc"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(){s.onDeletePage()})},onNewPage:function(){Compozr.postNew(this.options.newPageUrl,Compozr.menu.NewPage)},onBeforeSavePage:function(e){},onSavePage:function(){var e=this.view.loadPageModel();e=$.extend(e,{Id:this.model.Id,Enabled:this.model.Enabled}),this.onBeforeSavePage(e);var t=this;

Compozr.postSave(t.options.savePageUrl,Compozr.menu.Save.add(Compozr.menu.Revert),e,function(){!t.model.Enabled&&window.confirm(t.resources.enablePageMessage)&&Compozr.menu.TogglePage.click(),t.isEditMode()&&(t.options.previewAfterSave?Compozr.menu.EditPage.click():Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).show()),Compozr.menuWithAlias.Save.prev().add(Compozr.menuWithAlias.Revert.prev()).hide(),t.isEditMode()||Compozr.menuWithAlias.NewPage.show(),$Compozr.triggerHandler("save",e),t.model=$.extend(t.model,e)})},onRevertPage:function(){this.isEditMode()?this.switchToPreviewMode():(Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).hide(),Compozr.menuWithAlias.NewPage.show());var e=this;Compozr.queueTask("restoreData",function(){e.restoreData()},function(){return 0===e.view.cleanupPageEditorLock})},onDeletePage:function(){Compozr.postDelete(this.options.deletePageUrl,Compozr.menu.DeletePage)},initMenu:function(){this._super();var e=this;Compozr.menu.TogglePage.on("click"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(){e.togglePage()}),Compozr.menu.DeletePage.on("click"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(){Compozr.deleteDoc()}),Compozr.menu.NewPage.on("click"+GG.PageCompozr.MultiPage.DEFAULT_EVENT_DOMAIN,function(){Compozr.newDoc()})},switchToEditMode:function(){this._super(),Compozr.menuWithAlias.NewPage.hide(),Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).show()},switchToPreviewMode:function(){this._super(),Compozr.dirty()||(Compozr.menuWithAlias.NewPage.show(),Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).hide())},togglePage:function(){var e=this;Compozr.menu.TogglePage.data("jqXHR",Compozr.postJSON(this.options.togglePageUrl,{data:{enabled:!this.model.Enabled},onSuccess:function(t,o,i){i===Compozr.menu.TogglePage.data("jqXHR")&&(e.model.Enabled=!e.model.Enabled,Compozr.menuWithAlias.TogglePage.children("a").attr("title",e.model.Enabled?e.resources.hide:e.resources.show).children("span").removeClass(GG.PageCompozr.MultiPage.ENABLED_CSS_CLASS).removeClass(GG.PageCompozr.MultiPage.DISABLED_CSS_CLASS).addClass(e.model.Enabled?GG.PageCompozr.MultiPage.ENABLED_CSS_CLASS:GG.PageCompozr.MultiPage.DISABLED_CSS_CLASS))},onComplete:function(e,t){e===Compozr.menu.TogglePage.data("jqXHR")&&Compozr.menu.TogglePage.removeData("jqXHR")}}))}}}(),function(){"use strict";GG.namespace("GG.DocCompozr"),GG.DocCompozr.Resources=GG.Class.extend({tags:null,filters:null,series:null,title:null,urlFriendlyTitle:null,descriptionMeta:null,keywordsMeta:null,viewCount:null,edit:null,backToPreview:null,show:null,hide:null,enableDocMessage:null,docImages:null,insertImageHint:null,imageCaptionMessage:null,urlFriendlyTitleDescription:null,relatedDocs:null,pasteToolbarItemDescription:null})}(),function(){"use strict";GG.namespace("GG.DocCompozr");var e=".doc-compozr",t=".doc-compozr-place-holder",o="extra-info",i="place-holder",n="clearfix",s="clearfix visible-sm",a="clearfix visible-md visible-lg",r="col-sm-6 col-md-4",l="col-sm-12",c="navbar-fixed-bottom",d="images-panel",u="text-info",p="text-info note",m="folder-container",h="btn btn-link btn-lg",f="glyphicon glyphicon-plus",g="disabled";GG.DocCompozr.DocViewOptions=GG.Class.extend({imageListUrl:null,uploadImageUrl:null,renameImageUrl:null,deleteImageUrl:null,predefinedImageFileNames:[],searchRelatedDocsUrl:null}),GG.DocCompozr.DocView=GG.Class.extend({container:$(),options:new GG.DocCompozr.DocViewOptions,resources:new GG.DocCompozr.Resources,imagesPanel:$(),doc:$(),extraInfo:$(),tags:$(),filters:$(),series:$(),title:$(),titleEditor:$(),urlFriendlyTitle:$(),descriptionMeta:$(),keywordsMeta:$(),viewCount:$(),relatedDocs:$(),hiddenOnEditMode:$(),assignElementsLock:0,prepareDocEditorLock:0,cleanupDocEditorLock:0,init:function(e,t,o){this.container=$(e),this.options=$.extend(this.options,t),this.resources=$.extend(this.resources,o),this.doc=$(".doc",this.container),this.title=$("header h1",this.doc),this.relatedDocs=$(".related-docs",this.container),this.hiddenOnEditMode=this.hiddenOnEditMode.add(this.relatedDocs)},assignElements:function(){this.assignElementsLock++;var t;this.doc.append(this.extraInfo=$("<div></div>").hide().addClass(o).append(t=$("<ul></ul>").addClass(n))),t.append($("<li></li>").addClass(l).css("margin-bottom","0").append(this.urlFriendlyTitle=$("<div></div>"))),this.urlFriendlyTitle.after($("<span></span>").html(this.resources.urlFriendlyTitleDescription)),t.append($("<li></li>").addClass(r).append(this.tags=$('<input type="hidden" />'))),t.append($("<li></li>").addClass(r).append(this.filters=$('<input type="hidden" />'))),t.append($("<li></li>").addClass(s)),t.append($("<li></li>").addClass(r).append(this.series=$('<input type="hidden" />'))),t.append($("<li></li>").addClass(a)),t.append($("<li></li>").addClass(r).append(this.viewCount=$("<div></div>"))),t.append($("<li></li>").addClass(s)),t.append($("<li></li>").addClass(r).append(this.descriptionMeta=$("<div></div>"))),t.append($("<li></li>").addClass(r).append(this.keywordsMeta=$("<div></div>")));var i;$("body").append(this.imagesPanel=$("<section></section>")),this.imagesPanel.addClass(c).addClass(d).hide().append($("<h2></h2>").addClass(u).html(this.resources.docImages)).append($("<div></div>").addClass(p).html(this.resources.insertImageHint).hide()).append($("<div></div>").addClass(m).append(i=$("<div></div>")));var g={listUrl:this.options.imageListUrl,uploadUrl:this.options.uploadImageUrl,renameUrl:this.options.renameImageUrl,deleteUrl:this.options.deleteImageUrl,predefinedFileNames:this.options.predefinedImageFileNames,formatUploadButton:function(){return $("<div></div>").addClass(h).append($("<span></span>").addClass(f))}},C=new GG.Components.RemoteFolder(i,g);i.data("remoteFolder",C),$(C).on("beginEdit"+e,function(e,t){Compozr.fixSizeViewport(),$("["+Compozr.CONTENTEDITABLE+"]",t).attr(Compozr.EXCLUDED,"")}).on("comitEdit"+e+" cancelEdit"+e,function(){Compozr.restoreViewport()}),this.assignElementsLock--},prepareDocEditor:function(){this.prepareDocEditorLock++;var t=this;$("body").css("padding-bottom","+="+this.imagesPanel.outerHeight()),Modernizr.touch&&($Compozr.on("inputfocus"+e,function(){$("body").css("padding-bottom","-="+t.imagesPanel.outerHeight())}),$Compozr.on("inputblur"+e,function(){$("body").css("padding-bottom","+="+t.imagesPanel.outerHeight())})),this.imagesPanel.show(),this.titleEditor=$("<div></div>").html(this.title.text()),this.title.html("").append(this.titleEditor),this.extraInfo.show(),this.initPlaceHolder(this.titleEditor,this.resources.title,!0,!1),this.initPlaceHolder(this.urlFriendlyTitle,this.resources.urlFriendlyTitle,!0,!1),this.initPlaceHolder(this.descriptionMeta,this.resources.descriptionMeta,!1,!0),this.initPlaceHolder(this.keywordsMeta,this.resources.keywordsMeta,!1,!0),this.initPlaceHolder(this.viewCount,this.resources.viewCount,!1,!0),this.titleEditor.on("keyup"+e,function(){var e=t.urlFriendlyTitle.html();t.urlFriendlyTitle.removeClass(i),t.urlFriendlyTitle.html(GG.toUrlFriendly(t.titleEditor.text())),t.urlFriendlyTitle.html()!==e&&Compozr.dirty(!0)}),this.prepareDocEditorLock--},cleanupDocEditor:function(){this.cleanupDocEditorLock++,this.destroyPlaceHolder(this.titleEditor,!1),this.destroyPlaceHolder(this.urlFriendlyTitle,!1),this.destroyPlaceHolder(this.descriptionMeta,!0),this.destroyPlaceHolder(this.keywordsMeta,!0),this.destroyPlaceHolder(this.viewCount,!0),this.imagesPanel.hide(),$Compozr.off("inputfocus"+e+" inputblur"+e),$("body").css("padding-bottom","-="+this.imagesPanel.outerHeight()),this.extraInfo.hide(),this.title.html(this.titleEditor.text()),this.titleEditor=$(),this.cleanupDocEditorLock--},initPlaceHolder:function(e,o,n,s){function a(e,t){var o=$.trim(e.html()),a=$("<div></div>").html(o);a.find(".rangySelectionBoundary").is("*")||(a.cleanHtml("filterTags",{tags:["img"]}),""===$.trim(a.html())?(e.addClass(i+(n?" required":"")).html(t),s&&e.prev().hide()):(e.html(o),s&&e.prev().show()))}var r=this;if(e.length&&e.length>1)$.each(e,function(e,t){r.initPlaceHolder($(t),o,n,s)});else{s&&e.before($("<label></label>").hide().html(o));var l="["+o+"]";a(e,l),e.css("min-height")&&0!==parseInt(e.css("min-height"),10)||e.css("min-height",e.height()+"px"),e.on("focus"+t,function(){var t=$(this);t.hasClass(i)&&(t.removeClass(i).html(""),s&&e.prev().show())}).on("blur"+t,function(){a($(this),l)})}},destroyPlaceHolder:function(e,o){var n=this;e.length&&e.length>1?$.each(e,function(e,t){n.destroyPlaceHolder($(t),o)}):(e.off(t),e.css("min-height",""),e.hasClass(i)&&e.html("").removeClass(i),o&&e.prev().remove())},setField:function(e,t){e.triggerHandler("focus"),e.html(t),e.triggerHandler("blur")},loadDocModel:function(){return{TagsEdit:this.tags.val(),FiltersEdit:this.filters.val(),SeriesEdit:this.series.val(),Title:this.loadField(this.titleEditor.is("*")?this.titleEditor:this.title),UrlFriendlyTitle:this.loadField(this.urlFriendlyTitle),DescriptionMetaEdit:this.loadField(this.descriptionMeta),KeywordsMetaEdit:this.loadField(this.keywordsMeta),ViewCount:this.loadField(this.viewCount)}},loadField:function(e,t){return e.hasClass(i)?"":$.trim(t===!0?e.html():e.text())},updateRelatedDocs:function(e,t){var o=this,i=this.series.val();if(""===i)this.hiddenOnEditMode=this.hiddenOnEditMode.not(this.relatedDocs),this.relatedDocs.removeData("jqXHR").remove(),this.relatedDocs=$();else{var n;this.relatedDocs.is("*")?n=$("ul",this.relatedDocs):(this.relatedDocs=$("<aside><aside>").hide().addClass("related-docs").attr("role","complementary").append($("<h2></h2>").append(this.resources.relatedDocs)).append(n=$("<ul></ul>")),this.doc.after(this.relatedDocs),this.hiddenOnEditMode=this.hiddenOnEditMode.add(this.relatedDocs)),this.relatedDocs.data("jqXHR",Compozr.getJSON(this.options.searchRelatedDocsUrl,{data:{id:e,term:i},onSuccess:function(e,i,s){if(s===o.relatedDocs.data("jqXHR")){var a=e.models;0===a.length?(o.relatedDocs.remove(),o.relatedDocs=$()):(n.html(""),$.each(a,function(e,o){var i=$("<li></li>");o.Enabled||i.addClass(g),n.append(i.append($("<a></a>").attr("href",t+"/"+o.UrlFriendlyTitle).html(o.Title)))}),o.relatedDocs.show())}},onComplete:function(e,t){e===o.relatedDocs.data("jqXHR")&&o.relatedDocs.removeData("jqXHR")}}))}}})}(),function(){"use strict";GG.namespace("GG.DocCompozr");var e=".doc-compozr",t="glyphicon",o="glyphicon-edit",i="glyphicon-check",n="glyphicon-star",s="glyphicon-star-empty",a=new Compozr.HtmlEditorToolbar;GG.DocCompozr.DocModel=GG.Class.extend({Id:null,Enabled:null,Tags:null,Filters:null,Series:null,Title:null,UrlFriendlyTitle:null,DescriptionMeta:null,KeywordsMeta:null,ViewCount:null}),GG.DocCompozr.DocControllerOptions=GG.Class.extend({newDocUrl:null,saveDocUrl:null,toggleDocUrl:null,deleteDocUrl:null,docUrl:null,imagesPath:null,editMode:!1,previewAfterSave:!0,searchTagsUrl:null,allowedFilters:[],searchSeriesUrl:null}),GG.DocCompozr.DocController=GG.Class.extend({view:new GG.DocCompozr.DocView,options:new GG.DocCompozr.DocControllerOptions,model:new GG.DocCompozr.DocModel,resources:new GG.DocCompozr.Resources,assignElementsLock:0,enableElementsEditabilityLock:0,disableElementsEditabilityLock:0,shortcutLock:!0,init:function(t,o,i,n){function s(){Modernizr.touch||$(document).on("keypress"+e,function(e){if(!r.shortcutLock&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&!e.altKey)switch(e.which){case 69:case 101:e.preventDefault(),$(":focus").blur(),Compozr.menu.EditDoc.click();break;case 78:case 110:r.isEditMode()||(e.preventDefault(),$(":focus").blur(),Compozr.menu.NewDoc.click())}})}this.view=$.extend(this.view,t),this.view.container.data("gg.doc-compozr.doc-controller",this),this.options=$.extend(this.options,o),this.model=$.extend(this.model,i),this.resources=$.extend(this.resources,n),this.options.saveDocUrl+="/"+this.model.Id,this.options.toggleDocUrl+="/"+this.model.Id,this.options.deleteDocUrl+="/"+this.model.Id,this.view.options.imageListUrl+="/"+this.model.Id,this.view.options.uploadImageUrl+="/"+this.model.Id,this.view.options.renameImageUrl+="/"+this.model.Id,this.view.options.deleteImageUrl+="/"+this.model.Id;var r=this;$.each(this.options.allowedFilters,function(e,t){r.options.allowedFilters[e]={id:t.toLowerCase(),text:t}}),this.model.Filters=this.model.Filters.toLowerCase(),s(),$Compozr.on("init"+e,function(e,t){t.show=!1,t.attachEditorEvents=!1,a=new Compozr.HtmlEditorToolbar(Compozr.container,{pasteDescription:r.resources.pasteToolbarItemDescription}),a.hide(),r.initMenu(),r.assignElements(),Compozr.queueTask("finishInit",function(){r.backupData(),Compozr.fadeIn(),r.shortcutLock=!1,r.options.editMode&&Compozr.menu.EditDoc.click()},function(){return 0===r.assignElementsLock})}),$Compozr.on("newDoc"+e,function(){r.onNewDoc()}),$Compozr.on("saveDoc"+e,function(){r.onSaveDoc()}),$Compozr.on("revertDoc"+e,function(){r.onRevertDoc()}),$Compozr.on("deleteDoc"+e,function(){r.onDeleteDoc()})},onNewDoc:function(){Compozr.postNew(this.options.newDocUrl,Compozr.menu.NewDoc)},onBeforeSaveDoc:function(e){},onSaveDoc:function(){var e=this.view.loadDocModel();e=$.extend(e,{Id:this.model.Id,Enabled:this.model.Enabled}),this.onBeforeSaveDoc(e);var t=this;Compozr.postSave(t.options.saveDocUrl,Compozr.menu.Save.add(Compozr.menu.Revert),e,function(){!t.model.Enabled&&window.confirm(t.resources.enableDocMessage)&&Compozr.menu.ToggleDoc.click(),e.UrlFriendlyTitle!==t.model.UrlFriendlyTitle&&(Compozr.cancelTask("redirectByUrlFriendlyTitle"),Compozr.queueTask("redirectByUrlFriendlyTitle",function(){Compozr.dirty(!1),window.location=t.options.docUrl+"/"+e.UrlFriendlyTitle},function(){return!Compozr.menu.ToggleDoc.data("jqXHR")})),t.isEditMode()&&(t.options.previewAfterSave?Compozr.menu.EditDoc.click():Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).show()),Compozr.menuWithAlias.Save.prev().add(Compozr.menuWithAlias.Revert.prev()).hide(),t.isEditMode()||Compozr.menuWithAlias.NewDoc.show(),$Compozr.triggerHandler("save",e),t.model=$.extend(t.model,e)})},onRevertDoc:function(){this.isEditMode()?this.switchToPreviewMode():(Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).hide(),Compozr.menuWithAlias.NewDoc.show());var e=this;Compozr.queueTask("restoreData",function(){e.restoreData()},function(){return 0===e.view.cleanupDocEditorLock})},onDeleteDoc:function(){Compozr.postDelete(this.options.deleteDocUrl,Compozr.menu.DeleteDoc)},initMenu:function(){var t=this;Compozr.menu.EditDoc.on("click"+e,function(){t.switchMode()}),Compozr.menu.ToggleDoc.on("click"+e,function(){t.toggleDoc()}),Compozr.menu.DeleteDoc.on("click"+e,function(){Compozr.deleteDoc()}),Compozr.menu.NewDoc.on("click"+e,function(){Compozr.newDoc()})},switchMode:function(){this.isEditMode()?this.switchToPreviewMode():this.switchToEditMode()},isEditMode:function(){return $("."+t,Compozr.menu.EditDoc).hasClass(i)},switchToEditMode:function(){var e=this;this.shortcutLock=!0,Compozr.fadeOut(),$("."+t,Compozr.menuWithAlias.EditDoc).removeClass(o).addClass(i),$("[title]",Compozr.menuWithAlias.EditDoc).attr("title",this.resources.backToPreview),Compozr.menuWithAlias.NewDoc.hide(),a.show(),Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).show(),this.view.hiddenOnEditMode.hide(),this.view.prepareDocEditor(function(t){return e.turnOffContentHtml(t)}),Compozr.queueTask("enableElementsEditability",function(){e.enableElementsEditability()},function(){return 0===e.view.prepareDocEditorLock}),Compozr.queueTask("finishSwitchToEditMode",function(){Compozr.attachEditorEvents(),Compozr.fadeIn(),e.shortcutLock=!1,$Compozr.triggerHandler("edit",e.isEditMode())},function(){return 0===e.enableElementsEditabilityLock})},switchToPreviewMode:function(){var e=this;this.shortcutLock=!0,Compozr.fadeOut(),$("."+t,Compozr.menuWithAlias.EditDoc).removeClass(i).addClass(o),$("[title]",Compozr.menuWithAlias.EditDoc).attr("title",this.resources.edit),Compozr.dirty()||Compozr.menuWithAlias.NewDoc.show(),a.hide(),Compozr.dirty()||Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).hide(),Compozr.detachEditorEvents(),this.disableElementsEditability(),Compozr.queueTask("cleanupDocEditor",function(){e.view.cleanupDocEditor(function(t){return e.turnOnContentHtml(t)})},function(){return 0===e.disableElementsEditabilityLock}),Compozr.queueTask("finishSwitchToPreviewMode",function(){e.view.hiddenOnEditMode.show(),e.view.updateRelatedDocs(e.model.Id,e.options.docUrl),Compozr.fadeIn(),e.shortcutLock=!1,$Compozr.triggerHandler("edit",e.isEditMode())},function(){return 0===e.view.cleanupDocEditorLock})},backupData:function(){this.model=$.extend(this.model,{Title:this.view.title.html()}),$Compozr.triggerHandler("backupData")},restoreData:function(){this.view.tags.val(this.model.Tags),this.view.filters.val(this.model.Filters),this.view.series.val(this.model.Series),this.view.title.html(this.model.Title),this.view.urlFriendlyTitle.html(this.model.UrlFriendlyTitle),this.view.descriptionMeta.html(this.model.DescriptionMeta),this.view.keywordsMeta.html(this.model.KeywordsMeta),this.view.viewCount.html(this.model.ViewCount),$Compozr.triggerHandler("restoreData")},toggleDoc:function(){var e=this;Compozr.menu.ToggleDoc.data("jqXHR",Compozr.postJSON(this.options.toggleDocUrl,{data:{enabled:!this.model.Enabled},onSuccess:function(t,o,i){function a(e,t){Compozr.menuWithAlias.ToggleDoc.children("a").attr("title",e.Enabled?t.hide:t.show).children("span").removeClass(n).removeClass(s).addClass(e.Enabled?n:s)}i===Compozr.menu.ToggleDoc.data("jqXHR")&&(e.model.Enabled=!e.model.Enabled,a(e.model,e.resources))},onComplete:function(e,t){e===Compozr.menu.ToggleDoc.data("jqXHR")&&Compozr.menu.ToggleDoc.removeData("jqXHR")}}))},assignElements:function(){this.assignElementsLock++;var e=this;this.view.assignElements(),Compozr.queueTask("finishAssignElements",function(){e.view.tags.val(e.model.Tags),e.view.filters.val(e.model.Filters),e.view.series.val(e.model.Series),e.view.urlFriendlyTitle.html(e.model.UrlFriendlyTitle),e.view.descriptionMeta.html(e.model.DescriptionMeta),e.view.keywordsMeta.html(e.model.KeywordsMeta),e.view.viewCount.html(e.model.ViewCount),new Compozr.HtmlImageToolbar(e.view.imagesPanel,{imageCaptionMessage:e.resources.imageCaptionMessage}),e.assignElementsLock--},function(){return 0===e.view.assignElementsLock})},enableElementsEditability:function(){this.enableElementsEditabilityLock++;var t=this,o=this.view.titleEditor.add(this.view.urlFriendlyTitle).add(this.view.descriptionMeta).add(this.view.keywordsMeta).add(this.view.viewCount);o.attr(Compozr.CONTENTEDITABLE,"true").attr(Compozr.SINGLE_LINE,"").attr(Compozr.NO_HTML,"").attr(Compozr.SELECT_ON_FOCUS,""),this.view.urlFriendlyTitle.attr(Compozr.URL_FRIENDLY,""),Compozr.includeAllInputs(this.view.tags.add(this.view.filters).add(this.view.series)),this.view.tags.select2({width:"100%",placeholder:this.resources.tags,tags:[],createSearchChoice:function(e){return{id:e,text:e}},tokenSeparators:[","],query:function(e){Compozr.getJSON(t.options.searchTagsUrl,{data:{term:e.term},onSuccess:function(t){$.each(t.models,function(e,o){t.models[e]={id:o,text:o}}),e.callback({results:t.models})}})},initSelection:function(e,t){var o=$(e).val();if(""!==o){var i=o.split(",");$.each(i,function(e,t){i[e]={id:t,text:t}}),t(i)}}}).on("select2-focus"+e,function(){Compozr.fixSizeViewport()}).on("select2-blur"+e,function(){Compozr.restoreViewport()}),this.view.filters.select2({width:"100%",placeholder:this.resources.filters,multiple:!0,data:this.options.allowedFilters,maximumSelectionSize:this.options.allowedFilters.length}).on("select2-focus"+e,function(){Compozr.fixSizeViewport()}).on("select2-blur"+e,function(){Compozr.restoreViewport()}),this.view.series.select2({width:"100%",placeholder:this.resources.series,tags:[],createSearchChoice:function(e){return{id:e,text:e}},tokenSeparators:[","],query:function(e){Compozr.getJSON(t.options.searchSeriesUrl,{data:{term:e.term},onSuccess:function(t){$.each(t.models,function(e,o){t.models[e]={id:o,text:o}}),e.callback({results:t.models})}})},initSelection:function(e,t){var o=$(e).val();if(""!==o){var i=o.split(",");$.each(i,function(e,t){i[e]={id:t,text:t}}),t(i)}}}).on("select2-focus"+e,function(){Compozr.fixSizeViewport()}).on("select2-blur"+e,function(){Compozr.restoreViewport()}),this.enableElementsEditabilityLock--},disableElementsEditability:function(){this.disableElementsEditabilityLock++;var e=this.view.titleEditor.add(this.view.urlFriendlyTitle).add(this.view.descriptionMeta).add(this.view.keywordsMeta).add(this.view.viewCount);e.removeAttr(Compozr.CONTENTEDITABLE),this.view.tags.select2("destroy").removeAttr("style"),this.view.filters.select2("destroy").removeAttr("style"),this.view.series.select2("destroy").removeAttr("style"),this.disableElementsEditabilityLock--},turnOffContentHtml:function(e){var t=$("<div></div>").html(e),o=t.find("figure");$.each(o,function(e,t){var o=$(t),i=$("img",o),n=$("figcaption",o).html(),s="";if(i.is("*")){var a=i.attr("src"),r=i.attr("alt"),l=i.attr("caption"),c=i.attr("description"),d=a.substring(Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))+1,a.length);r=void 0===r?"":r,l=void 0===l?"":l,c=void 0===c?"":c,s+='[image name="'+d+'" alt="'+r+'" caption="'+l+'" description="'+c+'"]'}n&&(s+="[label]"+n+"[/label]"),o.replaceWith(s)});var i=t.find(".video-wrapper");$.each(i,function(e,t){var o,i,n=$(t),s=$("iframe",n);s.attr("src")&&0===s.attr("src").indexOf("http://www.youtube.com")&&(o=s.attr("src").substr("http://www.youtube.com/embed/".length,11),i="[youtube]"+o+"[/youtube]",n.replaceWith(i))});var n=t.find("div.aside");return $.each(n,function(e,t){var o=$(t),i="[aside]"+o.html()+"[/aside]";o.replaceWith(i)}),t.html()},turnOnContentHtml:function(e){var t,o,i;for(t=/\[image\s+name\s*=\s*('\s*((\w|\-)+.\w+)\s*'|"\s*((\w|\-)+.\w+)\s*")(\s+alt=\s*('\s*([\s\S]*?)\s*'|"\s*([\s\S]*?)\s*"))*(\s+caption=\s*('\s*([\s\S]*?)\s*'|"\s*([\s\S]*?)\s*"))*(\s+description=\s*('\s*([\s\S]*?)\s*'|"\s*([\s\S]*?)\s*"))*\s*\]/g;null!==(o=t.exec(e));){var n=o[2]?o[2]:o[4],s=o[8]?o[8]:o[9],a=o[12]?o[12]:o[13],r=o[16]?o[16]:o[17],l=this.options.imagesPath+"/"+n;i='<figure><img alt="'+s+'" caption="'+a+'" description="'+r+'" src="'+l+'" /></figure>',e=e.replace(o[0],i)}for(t=/\[label\][\s\S]*?\[\/label\]/g;null!==(o=t.exec(e));)i=o[0].replace(/<\/div>\s*<div>/g,"<br />"),e=e.replace(o[0],i);for(e=e.replace(/\[label\]/g,"<figure><figcaption>"),e=e.replace(/\[\/label\]/g,"</figcaption></figure>"),e=e.replace(/<\/figure><figure><figcaption>/g,"<figcaption>"),t=/\[youtube\]([a-zA-Z0-9]{11})\[\/youtube\]/g;null!==(o=t.exec(e));)i='<div class="video-wrapper"><div class="video-container"><iframe width="640" height="480" src="http://www.youtube.com/embed/'+o[1]+'?rel=0" frameborder="0" allowfullscreen></iframe></div></div>',e=e.replace(o[0],i);return e=e.replace(/\[aside\]/g,'<div class="aside">'),e=e.replace(/\[\/aside\]/g,"</div>")}})}(),function(){"use strict";GG.namespace("GG.Blog"),GG.Blog.Resources=GG.DocCompozr.Resources.extend({category:null,publishDate:null,author:null,sourceUrl:null,shortContent:null,content:null,categoryDescription:null,unnamedCategory:null,readingArticleWithoutCategory:null,readingArticleWithCategory:null})}(),function(){"use strict";GG.namespace("GG.Blog");var e=".doc-compozr";GG.Blog.Categories=GG.Class.extend({container:$(),resources:new GG.Blog.Resources,form:$(),categories:$(),categoryTemplate:$(),init:function(t,o){function i(){Modernizr.touch||$(document).on("keypress"+e,function(e){if((e.ctrlKey||e.metaKey)&&!e.shiftKey&&!e.altKey)switch(e.which){case 78:case 110:e.preventDefault(),Compozr.menu.NewCategory.click()}})}this.container=$(t),this.resources=$.extend(this.resources,o),this.form=$("form",this.container);var n=this;i(),$Compozr.on("init"+e,function(){n.initMenu(),n.assignElements(),n.backupData(),n.prepareEditor(n.categories),Compozr.menuWithAlias.Save.add(Compozr.menuWithAlias.Revert).show()}),$Compozr.on("saveDoc"+e,function(){n.onSaveDoc()}),$Compozr.on("revertDoc"+e,function(){n.onRevertDoc()})},onSaveDoc:function(){this.form.valid()&&(Compozr.dirty(!1),$.each(this.categories,function(e,t){var o=$(t),i=$("[name^='Categories[']",o);$.each(i,function(t,o){var i=$(o),n=i.attr("name");i.attr("name","Categories["+e+n.substr(n.lastIndexOf("].")))})}),this.form.submit())},onRevertDoc:function(){this.restoreData(),this.assignElements(),this.prepareEditor(this.categories)},backupData:function(){this.form.data("original",this.form.html())},restoreData:function(){this.form.html(this.form.data("original"))},newCategory:function(){var e=$(this.categoryTemplate.html()),t=$("input[name$='.Id']",e);t.val(parseInt(t.val(),10)-1),this.categoryTemplate.html(GG.outerHtml(e)),this.categories=this.categories.add(e),this.form.append(e),this.prepareEditor(e),Compozr.attachEditorEvents(e),Compozr.dirty(!0),$("input[name$='.Name']",e).focus()},deleteCategory:function(e){var t=$("input[name$='.Id']",e).val();$("input[name$='.ParentId'][value="+t+"]",this.categories).val(""),this.categories=this.categories.not(e),e.remove(),this.initParentDropdown(this.categories),Compozr.dirty(!0)},initMenu:function(){var t=this;Compozr.menu.NewCategory.on("click"+e,function(){t.newCategory()})},initParentDropdown:function(t){var o=this,i=$("input[name$='.ParentId']",t);i.select2("destroy").removeAttr("style").select2({width:"100%",placeholder:" ",allowClear:!0,query:function(e){var t=$("input[name$='.Id']",$(this.element).closest("fieldset")).val();e.callback({results:o.getModels(t)})},initSelection:function(e,t){var i=$(e).val();if(""!==i){var n=o.findModel(i);t(n)}}}).on("select2-focus"+e,function(){Compozr.fixSizeViewport()}).on("select2-blur"+e,function(){Compozr.restoreViewport()})},refreshParentDropdown:function(e){var t=$("input[name$='.ParentId']",e);$.each(t,function(e,t){$(t).data("select2").initSelection()})},prepareEditor:function(t){var o=this;Compozr.includeAllInputs(t),this.initParentDropdown(t),$("input",t).off(e),$("input[name$='.Name']",t).on("keyup"+e,function(){var e=$(this),t=e.val(),i=$("h1",e.closest("section")),n=$("input[name$='.UrlFriendlyName']",e.closest("fieldset")),s=n.val();i.text(""===t?o.resources.unnamedCategory:t),n.val(GG.toUrlFriendly(t)),n.val()!==s&&Compozr.dirty(!0)}),$("input[name$='.Name']",t).add($("input[name$='.UrlFriendlyName']",t)).on("change"+e,function(){o.refreshParentDropdown(o.categories)}),$("button",t).on("click"+e,function(){o.deleteCategory($(this).closest("section"))})},assignElements:function(){this.categoryTemplate=$("template",Compozr.container),this.categories=$("section",this.form)},getModels:function(e){var t=this,o=[];return $.each(this.categories,function(i,n){var s=$("input[name$='.Id']",n).val(),a=$("input[name$='.Name']",n).val(),r=$("input[name$='.UrlFriendlyName']",n).val();if(!e||s!==e){var l;l=""!==a&&""!==r?a+" ("+r+")":""!==a?a:""!==r?r:"["+t.resources.unnamedCategory+"]",o.push({id:s,name:a,urlFriendlyName:r,text:l})}}),o},findModel:function(e){var t=this.getModels(),o=null;return $.each(t,function(t,i){return i.id===e?(o=i,!1):void 0}),o}})}(),function(){"use strict";GG.namespace("GG.Blog");var e=".doc-compozr";GG.Blog.Index=GG.Class.extend({options:{newDocUrl:null},init:function(t){this.options=$.extend(this.options,t);var o=this;$Compozr.on("init"+e,function(){o.initMenu()}),$Compozr.on("newDoc"+e,function(){o.onNewDoc()})},onNewDoc:function(){Compozr.postNew(this.options.newDocUrl,Compozr.menu.NewDoc)},initMenu:function(){Compozr.menu.NewDoc.on("click"+e,function(){Compozr.newDoc()})}})}(),function(){"use strict";GG.namespace("GG.Blog");var e=".doc-compozr";GG.Blog.Category=GG.Class.extend({options:{newDocUrl:null},model:{Id:null},init:function(t,o){this.options=$.extend(this.options,t),this.model=$.extend(this.model,{Id:o.Id});var i=this;$Compozr.on("init"+e,function(){i.initMenu()}),$Compozr.on("newDoc"+e,function(){i.onNewDoc()})},onNewDoc:function(){Compozr.postNew(this.options.newDocUrl,Compozr.menu.NewDoc,{categoryId:this.model.Id})},initMenu:function(){Compozr.menu.NewDoc.on("click"+e,function(){Compozr.newDoc()})}})}(),function(){"use strict";GG.namespace("GG.Blog");var e="extra-info",t="clearfix",o="col-sm-4 col-md-3 col-lg-2",i="col-sm-8 col-md-3",n="clearfix visible-sm",s="col-sm-4 col-md-3",a="col-sm-8 col-md-3 col-lg-4",r="active",l='<div class="input-group date"><input type="text" class="form-control" /><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span></div>';GG.Blog.ArticleViewOptions=GG.DocCompozr.DocViewOptions.extend({categoryUrl:null,findBloggerUrl:null,bloggerUrl:null}),GG.Blog.ArticleView=GG.DocCompozr.DocView.extend({options:new GG.Blog.ArticleViewOptions,resources:new GG.Blog.Resources,categoryId:$(),publishDate:$(),author:$(),sourceUrl:$(),shortContent:$(),content:$(),headerDisplay:$(),breadcrumbs:$(),categories:$(),init:function(e,t,o){this._super(e,t,o),this.shortContent=$(".short-content",this.doc),this.content=$(".content",this.doc),this.headerDisplay=$("header small",this.doc),this.breadcrumbs=$(".breadcrumbs",this.container),this.categories=$(".categories",this.container),this.hiddenOnEditMode=this.hiddenOnEditMode.add($(".social-network",this.container)).add(this.breadcrumbs).add(this.categories)},assignElements:function(){this.assignElementsLock++,this._super();var r,c;this.headerDisplay.after(r=$("<div></div>").hide().addClass(e).append(c=$("<ul></ul>").addClass(t))),c.append($("<li></li>").addClass(o).append(this.publishDate=$(l).find("input").attr("placeholder",this.resources.publishDate).end())),c.append($("<li></li>").addClass(i).append(this.categoryId=$('<input type="hidden" />'))),this.categoryId.after($("<span></span>").html(this.resources.categoryDescription)),c.append($("<li></li>").addClass(n)),c.append($("<li></li>").addClass(s).append(this.author=$("<div></div>"))),c.append($("<li></li>").addClass(a).append(this.sourceUrl=$("<div></div>"))),this.extraInfo=this.extraInfo.add(r),this.assignElementsLock--},prepareDocEditor:function(e){this.prepareDocEditorLock++,this._super(),this.initPlaceHolder(this.author,this.resources.author,!1,!0),this.initPlaceHolder(this.sourceUrl,this.resources.sourceUrl,!1,!0),this.initPlaceHolder(this.shortContent,this.resources.shortContent,!0,!1),this.initPlaceHolder(this.content,this.resources.content,!1,!1),this.shortContent.add(this.content).css("min-height","200px"),this.shortContent.html(e(this.shortContent.html())),this.content.html(e(this.content.html())),this.prepareDocEditorLock--},cleanupDocEditor:function(e){this.cleanupDocEditorLock++,this._super(),this.destroyPlaceHolder(this.author,!0),this.destroyPlaceHolder(this.sourceUrl,!0),this.destroyPlaceHolder(this.shortContent,!1),this.destroyPlaceHolder(this.content,!1),this.shortContent.html(e(this.shortContent.html())),this.content.html(e(this.content.html())),this.cleanupDocEditorLock--},loadDocModel:function(){var e=this._super();return $.extend(e,{CategoryId:this.categoryId.val(),PublishDate:this.publishDate.find("input").val(),Author:this.loadField(this.author),SourceUrl:this.loadField(this.sourceUrl),ShortContent:this.loadField(this.shortContent,!0),Content:this.loadField(this.content,!0)})},updateHeaderDisplay:function(){var e=this,t=this.categoryId.select2("data"),o=this.publishDate.find("input").val(),i=o.substring(0,o.indexOf(" ")),n=this.loadField(this.author),s=this.loadField(this.sourceUrl),a=null,r=null,l=null;""!==n&&""===s?this.headerDisplay.data("jqXHR",Compozr.getJSON(this.options.findBloggerUrl,{data:{penName:n},onSuccess:function(t,o,i){i===e.headerDisplay.data("jqXHR")&&(a=t.model.PenName,r=t.model.UrlFriendlyPenName,l=t.model.AvatarThumbnailImage)},onComplete:function(t,o){t===e.headerDisplay.data("jqXHR")&&e.headerDisplay.removeData("jqXHR")}})):this.headerDisplay.removeData("jqXHR"),Compozr.cancelTask("updateHeaderDisplay"),Compozr.queueTask("updateHeaderDisplay",function(){var c=$("<div></div>");if(""!==n){if(""===s)if(null===a)c.append($("<span></span>").html(n));else{var d=e.options.bloggerUrl+"/"+r;null!==l&&c.append($("<a></a>").addClass("avatar thumb").attr("href",d).attr("title",a).append($("<img />").attr("src",l).attr("alt",a))),
c.append($("<a></a>").attr("href",d).html(a))}else c.append($("<a></a>").attr("href",s).attr("target","_blank").attr("rel","nofollow").html(n));c.append(", ")}e.title.prev().remove();var u=$("a.avatar",c);u.is("*")&&e.title.before(u.clone()),c.append($("<time />").attr("datetime",o).attr("pubdate","").html(i)),null!==t&&t.enabled&&(c.append(" | "),c.append($("<a></a>").attr("href",e.options.categoryUrl+"/"+t.urlFriendlyName).html(t.name))),e.headerDisplay.html(c.html())},function(){return!e.headerDisplay.data("jqXHR")})},updateBreadcrumbsCategories:function(){var e=$("<div></div>"),t=$("a[href^='"+this.options.categoryUrl+"']",this.headerDisplay),o=t.is("*"),i=o?this.resources.readingArticleWithCategory:this.resources.readingArticleWithoutCategory;t=o?t:null,e.append(this.breadcrumbs.children().first()),i=i.replace("{0}",GG.outerHtml($("a",this.breadcrumbs).first().html((this.titleEditor.is("*")?this.titleEditor:this.title).html()))),o&&(i=i.replace("{1}",GG.outerHtml(t))),e.append(i),this.breadcrumbs.html(e.html()),$("li",this.categories).removeClass(r),o&&$("a[href='"+t.attr("href")+"']",this.categories).closest("li").addClass(r)}})}(),function(){"use strict";GG.namespace("GG.Blog");var e=".doc-compozr";GG.Blog.ArticleModel=GG.DocCompozr.DocModel.extend({CategoryId:null,PublishDate:null,Author:null,SourceUrl:null,HeaderDisplay:null,Breadcrumbs:null}),GG.Blog.ArticleControllerOptions=GG.DocCompozr.DocControllerOptions.extend({findCategoryUrl:null,searchCategoriesUrl:null,language:null,autoRefreshOnCategoryChange:!1}),GG.Blog.ArticleController=GG.DocCompozr.DocController.extend({view:new GG.Blog.ArticleView,options:new GG.Blog.ArticleControllerOptions,model:new GG.Blog.ArticleModel,resources:new GG.Blog.Resources,init:function(t,o,i,n){if(this._super(t,o,i,n),$.extend($.fn.select2.defaults,$.fn.select2.locales[this.options.language]),this.options.autoRefreshOnCategoryChange){var s=this;$Compozr.on("save"+e,function(e,t){t.CategoryId!==s.model.CategoryId&&t.UrlFriendlyTitle===s.model.UrlFriendlyTitle&&(Compozr.cancelTask("redirectByCategoryId"),Compozr.queueTask("redirectByCategoryId",function(){Compozr.dirty(!1),window.location=s.options.docUrl+"/"+t.UrlFriendlyTitle},function(){return!Compozr.menu.ToggleDoc.data("jqXHR")})),Compozr.menuWithAlias.ManageCategories.show(),s.view.updateBreadcrumbsCategories(),s.model=$.extend(s.model,{HeaderDisplay:s.view.headerDisplay.html(),Breadcrumbs:s.view.breadcrumbs.html()})})}},onNewDoc:function(){Compozr.postNew(this.options.newDocUrl,Compozr.menu.NewDoc,{categoryId:this.view.categoryId.val()})},onBeforeSaveDoc:function(e){e.ShortContent=$.trim(this.isEditMode()?e.ShortContent:this.turnOffContentHtml(e.ShortContent)),e.Content=$.trim(this.isEditMode()?e.Content:this.turnOffContentHtml(e.Content))},onRevertDoc:function(){this._super(),Compozr.menuWithAlias.ManageCategories.show()},switchToEditMode:function(){this._super(),Compozr.menuWithAlias.ManageCategories.hide()},switchToPreviewMode:function(){this._super(),Compozr.dirty()||Compozr.menuWithAlias.ManageCategories.show(),this.view.updateBreadcrumbsCategories()},backupData:function(){this._super(),this.model=$.extend(this.model,{ShortContent:this.view.shortContent.html(),Content:this.view.content.html(),HeaderDisplay:this.view.headerDisplay.html(),Breadcrumbs:this.view.breadcrumbs.html()})},restoreData:function(){this._super(),this.view.categoryId.val(this.model.CategoryId),this.view.publishDate.find("input").val(this.model.PublishDate),this.view.author.html(this.model.Author),this.view.sourceUrl.html(this.model.SourceUrl),this.view.shortContent.html(this.model.ShortContent),this.view.content.html(this.model.Content),this.view.headerDisplay.html(this.model.HeaderDisplay),this.view.title.prev().remove();var e=$("a.avatar",this.view.headerDisplay);e.is("*")&&this.view.title.before(e.clone()),this.view.breadcrumbs.html(this.model.Breadcrumbs)},assignElements:function(){this.assignElementsLock++,this._super();var e=this;Compozr.queueTask("finishAssignElements",function(){e.view.categoryId.val(e.model.CategoryId),e.view.publishDate.find("input").val(e.model.PublishDate),e.view.author.html(e.model.Author),e.view.sourceUrl.html(e.model.SourceUrl),e.assignElementsLock--},function(){return 0===e.view.assignElementsLock})},enableElementsEditability:function(){this.enableElementsEditabilityLock++,this._super();var t=this,o=this.view.author.add(this.view.sourceUrl).add(this.view.shortContent).add(this.view.content);o.attr(Compozr.CONTENTEDITABLE,"true").not(this.view.shortContent).not(this.view.content).attr(Compozr.SINGLE_LINE,"").attr(Compozr.NO_HTML,"").attr(Compozr.SELECT_ON_FOCUS,""),this.options.editMode&&this.view.shortContent.attr(Compozr.SELECT_ON_FIRST_FOCUS,""),Compozr.includeAllInputs(this.view.categoryId),this.view.categoryId.select2({width:"100%",placeholder:this.resources.category,allowClear:!0,query:function(e){Compozr.getJSON(t.options.searchCategoriesUrl,{data:{term:e.term},onSuccess:function(t){$.each(t.models,function(e,o){t.models[e]={id:o.Id,enabled:o.Enabled,name:o.Name,urlFriendlyName:o.UrlFriendlyName,text:o.Name+" ("+o.UrlFriendlyName+")"}}),e.callback({results:t.models})}})},initSelection:function(e,o){var i=$(e).val();""!==i&&Compozr.getJSON(t.options.findCategoryUrl,{data:{id:i},onSuccess:function(e){o({id:e.model.Id,enabled:e.model.Enabled,name:e.model.Name,urlFriendlyName:e.model.UrlFriendlyName,text:e.model.Name+" ("+e.model.UrlFriendlyName+")"})}})}}).on("change"+e,function(){t.view.updateHeaderDisplay()}).on("select2-focus"+e,function(){Compozr.fixSizeViewport()}).on("select2-blur"+e,function(){Compozr.restoreViewport()}),this.view.publishDate.datetimepicker({locale:this.options.language}).on("change.dp"+e,function(){Compozr.dirty(!0),t.view.updateHeaderDisplay()}).on("show.dp"+e,function(){Compozr.fixSizeViewport()}).on("hide.dp"+e,function(){Compozr.restoreViewport()}),this.view.author.add(this.view.sourceUrl).on("paste"+e+" blur"+e,function(){t.view.updateHeaderDisplay()}),this.enableElementsEditabilityLock--},disableElementsEditability:function(){this.disableElementsEditabilityLock++,this._super();var t=this.view.author.add(this.view.sourceUrl).add(this.view.shortContent).add(this.view.content);t.removeAttr(Compozr.CONTENTEDITABLE),this.view.categoryId.select2("destroy").removeAttr("style"),this.view.publishDate.data("DateTimePicker").destroy(),this.view.categoryId.add(this.view.publishDate).add(this.view.author).add(this.view.sourceUrl).off(e),this.disableElementsEditabilityLock--}})}(),function(){"use strict";GG.namespace("GG.Documentation.Base"),GG.Documentation.Base.Resources=GG.DocCompozr.Resources.extend({parentPaper:null,order:null,shortTitle:null,parentPaperDescription:null})}(),function(){"use strict";GG.namespace("GG.Documentation.Base");var e=".doc-compozr";GG.Documentation.Base.Index=GG.Class.extend({options:{newDocUrl:null},init:function(t){this.options=$.extend(this.options,t);var o=this;$Compozr.on("init"+e,function(){o.initMenu()}),$Compozr.on("newDoc"+e,function(){o.onNewDoc()})},onNewDoc:function(){Compozr.postNew(this.options.newDocUrl,Compozr.menu.NewDoc)},initMenu:function(){Compozr.menu.NewDoc.on("click"+e,function(){Compozr.newDoc()})}})}(),function(){"use strict";GG.namespace("GG.Documentation.Base");var e="clearfix visible-sm",t="clearfix visible-md visible-lg",o="col-sm-6 col-md-4",i="col-sm-6 col-md-8",n="col-sm-12";GG.Documentation.Base.PaperView=GG.DocCompozr.DocView.extend({resources:new GG.Documentation.Base.Resources,parentId:$(),order:$(),shortTitle:$(),assignElements:function(){this.assignElementsLock++,this._super(),this.urlFriendlyTitle.closest("li").before($("<li></li>").addClass(n).css("margin-bottom","0").append(this.parentId=$('<input type="hidden" />'))),this.parentId.after($("<span></span>").html(this.resources.parentPaperDescription)),this.descriptionMeta.closest("li").before($("<li></li>").addClass(i).append(this.shortTitle=$("<div></div>"))).before($("<li></li>").addClass(t)).before($("<li></li>").addClass(o).append(this.order=$("<div></div>"))).before($("<li></li>").addClass(e)),this.assignElementsLock--},prepareDocEditor:function(){this.prepareDocEditorLock++,this._super(),this.initPlaceHolder(this.order,this.resources.order,!1,!0),this.initPlaceHolder(this.shortTitle,this.resources.shortTitle,!1,!0),this.prepareDocEditorLock--},cleanupDocEditor:function(){this.cleanupDocEditorLock++,this._super(),this.destroyPlaceHolder(this.order,!0),this.destroyPlaceHolder(this.shortTitle,!0),this.cleanupDocEditorLock--},loadDocModel:function(){var e=this._super();return $.extend(e,{ParentId:this.parentId.val(),Order:this.loadField(this.order),ShortTitle:this.loadField(this.shortTitle)})}})}(),function(){"use strict";GG.namespace("GG.Documentation.Base");var e=".doc-compozr";GG.Documentation.Base.PaperModel=GG.DocCompozr.DocModel.extend({ParentId:null,Order:null,ShortTitle:null}),GG.Documentation.Base.PaperControllerOptions=GG.DocCompozr.DocControllerOptions.extend({findPaperUrl:null,searchPapersUrl:null,autoRefreshOnParentChange:!0}),GG.Documentation.Base.PaperController=GG.DocCompozr.DocController.extend({view:new GG.Documentation.Base.PaperView,options:new GG.Documentation.Base.PaperControllerOptions,model:new GG.Documentation.Base.PaperModel,resources:new GG.Documentation.Base.Resources,init:function(t,o,i,n){if(this._super(t,o,i,n),this.options.autoRefreshOnParentChange){var s=this;$Compozr.on("save"+e,function(e,t){t.ParentId!==s.model.ParentId&&t.UrlFriendlyTitle===s.model.UrlFriendlyTitle&&(Compozr.cancelTask("redirectByParentId"),Compozr.queueTask("redirectByParentId",function(){Compozr.dirty(!1),window.location=window.location},function(){return!Compozr.menu.ToggleDoc.data("jqXHR")}))})}},onNewDoc:function(){Compozr.postNew(this.options.newDocUrl,Compozr.menu.NewDoc,{parentId:this.model.Id})},restoreData:function(){this._super(),this.view.parentId.val(this.model.ParentId),this.view.order.html(this.model.Order),this.view.shortTitle.html(this.model.ShortTitle)},assignElements:function(){this.assignElementsLock++,this._super();var e=this;Compozr.queueTask("finishAssignElements",function(){e.view.parentId.val(e.model.ParentId),e.view.order.html(e.model.Order),e.view.shortTitle.html(e.model.ShortTitle),e.assignElementsLock--},function(){return 0===e.view.assignElementsLock})},enableElementsEditability:function(){this.enableElementsEditabilityLock++,this._super();var t=this,o=this.view.order.add(this.view.shortTitle);o.attr(Compozr.CONTENTEDITABLE,"true").attr(Compozr.SINGLE_LINE,"").attr(Compozr.NO_HTML,"").attr(Compozr.SELECT_ON_FOCUS,""),Compozr.includeAllInputs(this.view.parentId),this.view.parentId.select2({width:"100%",minimumInputLength:3,placeholder:this.resources.parentPaper,allowClear:!0,query:function(e){Compozr.getJSON(t.options.searchPapersUrl,{data:{term:e.term,currentId:t.model.Id},onSuccess:function(t){$.each(t.models,function(e,o){t.models[e]={id:o.Id,text:o.Title+" ("+o.UrlFriendlyTitle+")"}}),e.callback({results:t.models})}})},initSelection:function(e,o){var i=$(e).val();""!==i&&Compozr.getJSON(t.options.findPaperUrl,{data:{id:i},onSuccess:function(e){o({id:e.model.Id,text:e.model.Title+" ("+e.model.UrlFriendlyTitle+")"})}})}}).on("change"+e,function(){Compozr.dirty(!0)}).on("select2-focus"+e,function(){Compozr.fixSizeViewport()}).on("select2-blur"+e,function(){Compozr.restoreViewport()}),this.enableElementsEditabilityLock--},disableElementsEditability:function(){this.disableElementsEditabilityLock++,this._super();var e=this.view.order.add(this.view.shortTitle);e.removeAttr(Compozr.CONTENTEDITABLE),this.view.parentId.select2("destroy").removeAttr("style"),this.disableElementsEditabilityLock--}})}(),function(){"use strict";GG.namespace("GG.Documentation.Whole"),GG.Documentation.Whole.Resources=GG.Documentation.Base.Resources.extend({content:null})}(),function(){"use strict";GG.namespace("GG.Documentation.Whole"),GG.Documentation.Whole.Index=GG.Documentation.Base.Index.extend({})}(),function(){"use strict";GG.namespace("GG.Documentation.Whole"),GG.Documentation.Whole.PaperView=GG.Documentation.Base.PaperView.extend({resources:new GG.Documentation.Whole.Resources,content:$(),init:function(e,t,o){this._super(e,t,o),this.content=$(".content",this.doc)},prepareDocEditor:function(e){this.prepareDocEditorLock++,this._super(),this.initPlaceHolder(this.content,this.resources.content,!0,!1),this.content.css("min-height","200px").html(e(this.content.html())),this.prepareDocEditorLock--},cleanupDocEditor:function(e){this.cleanupDocEditorLock++,this._super(),this.destroyPlaceHolder(this.content,!1),this.content.html(e(this.content.html())),this.cleanupDocEditorLock--},loadDocModel:function(){var e=this._super();return $.extend(e,{Content:this.loadField(this.content,!0)})}})}(),function(){"use strict";GG.namespace("GG.Documentation.Whole"),GG.Documentation.Whole.PaperModel=GG.Documentation.Base.PaperModel.extend({Content:null}),GG.Documentation.Whole.PaperController=GG.Documentation.Base.PaperController.extend({view:new GG.Documentation.Whole.PaperView,model:new GG.Documentation.Whole.PaperModel,onBeforeSaveDoc:function(e){e.Content=$.trim(this.isEditMode()?e.Content:this.turnOffContentHtml(e.Content))},backupData:function(){this._super(),this.model=$.extend(this.model,{Content:this.view.content.html()})},restoreData:function(){this._super(),this.view.content.html(this.model.Content)},enableElementsEditability:function(){this.enableElementsEditabilityLock++,this._super(),this.view.content.attr(Compozr.CONTENTEDITABLE,"true"),this.options.editMode&&this.view.content.attr(Compozr.SELECT_ON_FIRST_FOCUS,""),this.enableElementsEditabilityLock--},disableElementsEditability:function(){this.disableElementsEditabilityLock++,this._super(),this.view.content.removeAttr(Compozr.CONTENTEDITABLE),this.disableElementsEditabilityLock--}})}(),function(){"use strict";GG.namespace("GG.Documentation.Split"),GG.Documentation.Split.Resources=GG.Documentation.Base.Resources.extend({content:null,editOrCompact:null,editOrFull:null,backToPreviewOrCompact:null,backToPreviewOrFull:null,autoSplit:null,autoSplitWarning:null,mergeWithAbove:null,mergeWithBelow:null,autoNumber:null,autoNumberWarning:null,autoCleanupNumber:null,autoCleanupNumberWarning:null,insertSectionAbove:null,insertSectionBelow:null,deleteSection:null,assignElementsProgress:null,setSectionsProgress:null,prepareDocEditorProgress:null,cleanupDocEditorProgress:null,enableElementsEditabilityProgress:null,disableElementsEditabilityProgress:null,autoSplitSectionProgress:null})}(),function(){"use strict";GG.namespace("GG.Documentation.Split"),GG.Documentation.Split.Index=GG.Documentation.Base.Index.extend({})}(),function(){"use strict";GG.namespace("GG.Documentation.Split");var e=".doc-compozr",t="has-numbers",o="editor",i="compact",n="number",s="content",a="tags",r="clearfix",l="toolbox",c="btn-group",d="btn btn-link btn-xs",u="auto-split glyphicon glyphicon-th-list",p="glyphicon glyphicon-th-large",m="merge-with-above glyphicon glyphicon-hand-up",h="merge-with-below glyphicon glyphicon-hand-down",f="auto-number fa fa-list-ol",g="auto-clean-up-number fa fa-list-ul",C="glyphicon glyphicon-plus-sign",v="insert-above glyphicon glyphicon-hand-up",E="insert-below glyphicon glyphicon-hand-down",w="delete glyphicon glyphicon-trash",G="data-compozr-toolbox-item",b=10;GG.Documentation.Split.PaperView=GG.Documentation.Base.PaperView.extend({resources:new GG.Documentation.Split.Resources,sections:$(),toolbox:$(),directories:$(),setSectionsLock:0,init:function(e,t,o){this._super(e,t,o),this.sections=$(".sections",this.container),this.directories=$(".directories",this.container).parent()},isCompactMode:function(){return this.doc.hasClass(i)},assignElements:function(){function t(){var t=$("<button></button>").attr("type","button").attr("tabindex","-1").addClass(d),i=t.clone().attr("title",o.resources.autoSplit).attr(G,"autoSplitSection").append($("<span></span>").addClass(u)),n=t.clone().attr("title",o.resources.mergeWithAbove).attr(G,"mergeSectionWithAbove").append($("<span></span>").addClass(p)).append(" ").append($("<span></span>").addClass(m)),s=t.clone().attr("title",o.resources.mergeWithBelow).attr(G,"mergeSectionWithBelow").append($("<span></span>").addClass(p)).append(" ").append($("<span></span>").addClass(h)),a=t.clone().attr("title",o.resources.autoNumber).attr(G,"autoNumberSections").append($("<span></span>").addClass(f)),r=t.clone().attr("title",o.resources.autoCleanupNumber).attr(G,"autoCleanUpNumberSections").append($("<span></span>").addClass(g)),b=t.clone().attr("title",o.resources.insertAbove).attr(G,"insertSectionAbove").append($("<span></span>").addClass(C)).append(" ").append($("<span></span>").addClass(v)),y=t.clone().attr("title",o.resources.insertSectionBelow).attr(G,"insertSectionBelow").append($("<span></span>").addClass(C)).append(" ").append($("<span></span>").addClass(E)),S=t.clone().attr("title",o.resources.deleteSection).append($("<span></span>").addClass(w)),D=$("<div></div>").addClass(l).append($("<div></div>").addClass(c).append(i).append(n).append(s).append(a).append(r).append(b).append(y).append(S));return $("["+G+"]",D).on("click"+e+"-toolbox",function(){$Compozr.triggerHandler($(this).attr(G),$(this).closest("li"))}),S.on("click"+e+"-toolbox",function(){var e=$(this).closest("li");o.sections.append(o.toolbox.hide()),e.remove(),Compozr.dirty(!0)}),D}this.assignElementsLock++,this._super();var o=this;this.sections.append(this.toolbox=t().hide()),this.assignSectionsElements($(">li",this.sections)),this.assignElementsLock--},prepareDocEditor:function(e){this.prepareDocEditorLock++,this._super(),this.isCompactMode()||(this.directories.hide(),this.doc.parent().css("width","100%")),this.doc.removeClass(t).addClass(o),$(">li",this.sections).show(),this.prepareSectionsEditor($(">li",this.sections),e,!1),this.prepareDocEditorLock--},cleanupDocEditor:function(e){this.cleanupDocEditorLock++,this._super();var n=this;this.cleanupSectionsEditorAsync($(">li",this.sections),e,function(){n.isCompactMode()||(n.doc.parent().css("width",""),n.directories.show()),n.doc.removeClass(o).addClass(t),n.checkHasNumbers(),n.doc.removeClass(i),n.cleanupDocEditorLock--},!1)},prepareDocFullMode:function(){this.prepareDocEditorLock++,this.directories.hide(),this.doc.removeClass(i).parent().css("width","100%"),this.prepareSectionsEditor($(">li",this.sections),null,!0),this.prepareDocEditorLock--},cleanupDocFullMode:function(){this.cleanupDocEditorLock++;var e=this;this.cleanupSectionsEditorAsync($(">li",this.sections),null,function(){e.doc.addClass(i).parent().css("width",""),e.directories.show(),e.cleanupDocEditorLock--},!0)},loadDocModel:function(){var e=this._super();return $.extend(e,{Sections:this.loadSections()})},createNewSection:function(){return $("<li></li>").append($("<div></div>").addClass(n)).append($("<div></div>").addClass(s))},assignSectionsElements:function(e){this.assignElementsLock++;var t=this;this.assignSectionsElementsAsync(e,function(){t.assignElementsLock--})},prepareSectionsEditor:function(e,t,o){this.prepareDocEditorLock++;var i=this;this.prepareSectionsEditorAsync(e,t,function(){i.refreshToolbox(),i.prepareDocEditorLock--},o)},checkHasNumbers:function(){var e=!1;$.each($(">li",this.sections),function(t,o){var i=$(o),a=$("."+n,i),r=$("."+s,i);a.is(":empty")&&r.is(":empty")?i.hide():a.is(":empty")||(e=!0)}),e?this.doc.addClass(t):this.doc.removeClass(t)},refreshToolbox:function(){var e=$("["+G+"=mergeSectionWithAbove]",this.sections),t=$("["+G+"=mergeSectionWithBelow]",this.sections),o=$("["+G+"=autoNumberSections]",this.sections);e.add(t).add(o).removeAttr("disabled"),$(">li:first",this.sections).find(e).attr("disabled","disabled"),$(">li:last",this.sections).find(t).attr("disabled","disabled").find(o).attr("disabled","disabled")},setSections:function(e){this.setSectionsLock++;var t=this;this.setSectionsAsync($(">li",this.sections),e.slice(0),function(){t.setSectionsLock--})},loadSections:function(){var e=this,t=[];return $.each($(">li",this.sections),function(o,i){t.push(e.loadSection($(i)))}),t},loadSection:function(e){return{Number:this.loadField($("."+n,e)),Content:this.loadField($("."+s,e),!0),TagsEdit:$("."+a,e).children("input").val()}},assignSectionsElementsAsync:function(e,t){var o=this,i=$("<div></div>").addClass(a).append($('<input type="hidden" />')).hide(),n=$("<div></div>").addClass(r).css("clear","both").hide(),l=$("."+s,e);l.length>1?(l=l.slice(0,b),window.setTimeout(function(){$.each(l,function(t,s){var a=$(s);o.assignSectionElements(a,n.clone(),i.clone()),e=e.not(a.closest("li"))}),o.assignSectionsElementsAsync(e,t)},10)):(1===l.length&&this.assignSectionElements(l,n,i),t())},assignSectionElements:function(e,t,o){Compozr.increaseProgress(1,this.resources.assignElementsProgress),e.after(t).after(o)},prepareSectionsEditorAsync:function(t,o,i,l){var c=this,d=t.slice(0,b),u=t.not(d),p=$("."+n,d),f=$("."+s,d),g=$("."+a,d),C=$("."+r,d);l||(p.css("min-height","0"),this.initPlaceHolder(p,"#",!1,!1),f.css("min-height","50px"),this.initPlaceHolder(f,this.resources.content,!0,!1),C.show(),o&&$(f).each(function(e,t){var i=$(t);i.html(o(i.html()))}),p.add(f).on("focus"+e,function(e){$(this).closest("li").find(C).append(c.toolbox.show()),c.refreshToolbox()}),Modernizr.touch||(p.add(f).on("keypress"+e,function(e){function t(e){return $("."+e.split(" ")[0],o).closest("button")}switch(e.which){case 77:case 109:(e.ctrlKey||e.metaKey)&&e.shiftKey&&!e.altKey?(e.preventDefault(),t(m).click()):!e.ctrlKey&&!e.metaKey||e.shiftKey||e.altKey||(e.preventDefault(),t(h).click());break;case 13:(e.ctrlKey||e.metaKey)&&e.shiftKey&&!e.altKey?(e.preventDefault(),t(v).click()):!e.ctrlKey&&!e.metaKey||e.shiftKey||e.altKey||(e.preventDefault(),t(E).click())}var o=$(this).closest("li")}),p.on("keydown"+e,function(e){var t=$();switch(e.which){case 38:t=$(this).closest("li").prev();break;case 40:case 13:t=$(this).closest("li").next()}t.is("*")&&$("."+n,t).focus()}))),this.isCompactMode()||g.show(),Compozr.increaseProgress(d.length,this.resources.prepareDocEditorProgress),u.length>0?window.setTimeout(function(){c.prepareSectionsEditorAsync(u,o,i,l)},10):i()},cleanupSectionsEditorAsync:function(t,o,i,l){var c=this,d=t.slice(0,b),u=t.not(d),p=$("."+n,d),m=$("."+s,d),h=$("."+a,d),f=$("."+r,d);this.isCompactMode()||h.hide(),l||(p.add(m).off(e),f.hide(),this.destroyPlaceHolder(p,!1),this.destroyPlaceHolder(m,!1),m.each(function(e,t){$(t).html(o($(t).html()))})),Compozr.increaseProgress(d.length,this.resources.cleanupDocEditorProgress),u.length>0?window.setTimeout(function(){c.cleanupSectionsEditorAsync(u,o,i,l)},10):i()},setSectionsAsync:function(e,t,o){var i=this,n=e.slice(0,b),s=e.not(n);$.each(n,function(e,o){i.setSection($(o),t[0]),t.shift()}),s.length>0?window.setTimeout(function(){i.setSectionsAsync(s,t,o)},10):o()},setSection:function(e,t){Compozr.increaseProgress(1,this.resources.setSectionsProgress),$("."+a,e).children("input").val(t.Tags)}})}(),function(){"use strict";GG.namespace("GG.Documentation.Split");var e=".doc-compozr",t="compact",o="number",i="content",n="tags",s="clearfix",a=10;GG.Documentation.Split.PaperModel=GG.Documentation.Base.PaperModel.extend({Sections:[]}),GG.Documentation.Split.PaperControllerOptions=GG.Documentation.Base.PaperControllerOptions.extend({compactModeAsDefault:!1,findSectionTagsUrl:null,searchSectionTagsUrl:null}),GG.Documentation.Split.PaperController=GG.Documentation.Base.PaperController.extend({view:new GG.Documentation.Split.PaperView,options:new GG.Documentation.Split.PaperControllerOptions,model:new GG.Documentation.Split.PaperModel,resources:new GG.Documentation.Split.Resources,init:function(t,o,i,n){function s(){Modernizr.touch||$(document).on("keypress"+e,function(e){if(!a.shortcutLock&&(e.ctrlKey||e.metaKey)&&e.shiftKey&&!e.altKey)switch(e.which){case 69:case 101:e.preventDefault(),$(":focus").blur();var t=$.Event("click",{shiftKey:!0});Compozr.menu.EditDoc.trigger(t);break;case 78:case 110:a.isEditMode()&&(e.preventDefault(),Compozr.menu.NewSection.click())}})}this._super(t,o,i,n);var a=this;$Compozr.on("autoSplitSection"+e,function(e,t){a.autoSplitSection($(t))}),$Compozr.on("mergeSectionWithAbove"+e,function(e,t){a.mergeSectionWithAbove($(t))}),$Compozr.on("mergeSectionWithBelow"+e,function(e,t){a.mergeSectionWithBelow($(t))}),$Compozr.on("autoNumberSections"+e,function(e,t){a.autoNumberSections($(t))}),$Compozr.on("autoCleanUpNumberSections"+e,function(e,t){a.autoCleanUpNumberSections($(t))}),$Compozr.on("insertSectionAbove"+e,function(e,t){a.insertSectionAbove($(t))}),$Compozr.on("insertSectionBelow"+e,function(e,t){a.insertSectionBelow($(t))}),s()},onBeforeSaveDoc:function(e){var t=this;$.each(e.Sections,function(e,o){o.Content=$.trim(t.isEditMode()?o.Content:t.turnOffContentHtml(o.Content))})},onRevertDoc:function(){this.view.sections.append(this.view.toolbox.hide());var e=$(">li",this.view.sections);e.length>this.model.Sections.length&&(e=e.slice(this.model.Sections.length),e.remove()),this._super()},initMenu:function(){this._super();var t=this;Compozr.menu.EditDoc.off("click"+e),Compozr.menu.EditDoc.on("click"+e,function(e){e.shiftKey?t.toggleCompactMode():t.switchMode()}),Compozr.menuWithAlias.NewSection.hide(),Compozr.menu.NewSection.on("click"+e,function(){t.newSection()})},switchMode:function(){this.isEditMode()?this.switchToPreviewMode():this.switchToEditMode(this.options.compactModeAsDefault)},switchToEditMode:function(e){e=e===!0,e&&this.view.doc.addClass(t),$(">li",this.view.sections).length>a&&Compozr.startProgress(0,2*$(">li",this.view.sections).length,this.resources.prepareDocEditorProgress),this._super();var o=this;$(">li",this.view.sections).length>a&&Compozr.queueTask("endProgress",function(){Compozr.endProgress()},function(){return 0===o.enableElementsEditabilityLock}),$("[title]",Compozr.menuWithAlias.EditDoc).attr("title",e?this.resources.backToPreviewOrFull:this.resources.backToPreviewOrCompact),Compozr.menuWithAlias.NewSection.show()},switchToPreviewMode:function(){$(">li",this.view.sections).length>a&&Compozr.startProgress(0,2*$(">li",this.view.sections).length,this.resources.disableElementsEditabilityProgress),this._super();var e=this;$(">li",this.view.sections).length>a&&Compozr.queueTask("endProgress",function(){Compozr.endProgress()},function(){return 0===e.view.cleanupDocEditorLock}),$("[title]",Compozr.menuWithAlias.EditDoc).attr("title",this.options.compactModeAsDefault?this.resources.editOrFull:this.resources.editOrCompact),Compozr.menuWithAlias.NewSection.hide()},toggleCompactMode:function(){this.isEditMode()?this.view.isCompactMode()?this.switchToFullMode():this.switchToCompactMode():this.switchToEditMode(!this.options.compactModeAsDefault)},switchToFullMode:function(){if(this.isEditMode()){var e=this;this.shortcutLock=!0,Compozr.fadeOut(),$(">li",this.view.sections).length>a&&Compozr.startProgress(0,2*$(">li",this.view.sections).length,this.resources.enableElementsEditabilityProgress),$("[title]",Compozr.menuWithAlias.EditDoc).attr("title",this.resources.backToPreviewOrCompact),this.view.prepareDocFullMode(),Compozr.queueTask("enableElementsEditability",function(){e.enableElementsEditability()},function(){return 0===e.view.prepareDocEditorLock}),Compozr.queueTask("finishSwitchToFullMode",function(){$(">li",e.view.sections).length>a&&Compozr.endProgress(),Compozr.fadeIn(),e.shortcutLock=!1},function(){return 0===e.enableElementsEditabilityLock})}},switchToCompactMode:function(){if(this.isEditMode()){var e=this;this.shortcutLock=!0,Compozr.fadeOut(),$(">li",this.view.sections).length>a&&Compozr.startProgress(0,2*$(">li",this.view.sections).length,this.resources.disableElementsEditabilityProgress),$("[title]",Compozr.menuWithAlias.EditDoc).attr("title",this.resources.backToPreviewOrFull),this.disableElementsEditability(!0),Compozr.queueTask("cleanupDocFullMode",function(){e.view.cleanupDocFullMode()},function(){return 0===e.disableElementsEditabilityLock}),Compozr.queueTask("finishSwitchToCompactMode",function(){$(">li",e.view.sections).length>a&&Compozr.endProgress(),Compozr.fadeIn(),e.shortcutLock=!1},function(){return 0===e.view.cleanupDocEditorLock})}},backupData:function(){this._super();var e=this,t=$(">li",this.view.sections);$.each(t,function(t,n){e.model.Sections[t]=$.extend(e.model.Sections[t],{Number:$("."+o,n).html(),Content:$("."+i,n).html()})})},restoreData:function(){this._super();var e=this,t=$(">li",this.view.sections),n=this.view.createNewSection();for(this.view.assignSectionsElements(n);t.length<this.model.Sections.length;){var s=n.clone();t.append(s),t=t.add(s)}$.each(t,function(t,n){$("."+o,n).html(e.model.Sections[t].Number),$("."+i,n).html(e.model.Sections[t].Content),e.view.setSection(n,e.model.Sections[t]),$(n).show()}),this.view.checkHasNumbers()},newSection:function(){var e=this.view.createNewSection(),t=this.view.sections.children().last();this.view.sections.append(e),t.is("*")&&$("."+o,e).html(this.increaseSectionNumber(t)),this.finishInsertSection(e)},autoSplitSection:function(e){if(window.confirm(this.resources.autoSplitWarning)){var t=this,o=GG.textWithLineBreaks(this.view.loadField($("."+i,e),!0)).split("\n");this.shortcutLock=!0,Compozr.fadeOut(),o.length>a&&Compozr.startProgress(0,3*o.length,this.resources.autoSplitSectionProgress),this.autoSplitSectionAsync(o.slice(0),e,e,!1,function(i){i&&(t.view.sections.append(t.view.toolbox.hide()),e.remove(),Compozr.dirty(!0)),o.length>a&&Compozr.endProgress(),Compozr.fadeIn(),t.shortcutLock=!1})}},autoSplitSectionAsync:function(e,t,n,s,r){var l=this,c=e.splice(0,a);$.each(c,function(e,a){if(""!==a.trim()){s=!0;var r=l.view.createNewSection();n.after(r),$("."+o,r).html(r.is(t.next())?l.view.loadField($("."+o,t)):l.increaseSectionNumber(n)),$("."+i,r).html(a.trim()),l.view.assignSectionsElements(r),l.view.prepareSectionsEditor(r),l.enableSectionsEditabilityAsync(r,function(){},!1),Compozr.attachEditorEvents(r),n=r,Compozr.increaseProgress(0,l.resources.autoSplitSectionProgress)}else Compozr.increaseProgress(3,l.resources.autoSplitSectionProgress)}),e.length>0?window.setTimeout(function(){l.autoSplitSectionAsync(e,t,n,s,r)},10):r(s)},mergeSectionWithAbove:function(e){var t=e.prev();t.is("*")&&this.mergeSections(t,e)},mergeSectionWithBelow:function(e){var t=e.next();t.is("*")&&this.mergeSections(e,t)},mergeSections:function(e,t){var o=this.view.loadField($("."+i,e),!0),s=this.view.loadField($("."+i,t),!0),a=$("."+n,e).children("input"),r=$("."+n,t).children("input");this.view.setField($("."+i,e),o+"<br />"+s),this.mergeMultiSelectFields(a,r),t.remove(),$("."+i,e).focus(),Compozr.dirty(!0)},mergeMultiSelectFields:function(e,t){var o,i;if(this.view.isCompactMode()){o=e.val().split(","),i=t.val().split(",");var n=$.merge(o,i);n=n.filter(function(e,t){return""!==e&&n.indexOf(e)===t}),e.val(n)}else o=e.select2("val"),i=t.select2("val"),e.select2("val",$.merge(o,i))},autoNumberSections:function(e){if(window.confirm(this.resources.autoNumberWarning)){for(var t=e.next();t.is("*");)this.view.setField($("."+o,t),this.increaseSectionNumber(t.prev())),t=t.next();Compozr.dirty(!0)}},autoCleanUpNumberSections:function(e){if(window.confirm(this.resources.autoCleanupNumberWarning)){for(var t=!1,n=e;n.is("*");){var s=$("."+o,n),a=$("."+i,n),r=this.view.loadField(s).trim(),l=this.view.loadField(a),c=this.view.loadField(a,!0),d=new RegExp("^"+r+"([.]|\\s)+");if(""!==r&&d.test(l)){for(t=!0,d=new RegExp("^"+r+"([.]|\\s|&nbsp;)+"),c=c.replace(d,"").trim();0===c.indexOf("&nbsp;");)c=c.substr("&nbsp;".length).trim();this.view.setField(a,c)}n=n.next()}t&&Compozr.dirty(!0)}},insertSectionAbove:function(e){var t=this.view.createNewSection();e.before(t),this.finishInsertSection(t)},insertSectionBelow:function(e){if(e.is(":last"))this.newSection();else{var t=this.view.createNewSection();e.after(t),this.finishInsertSection(t)}},assignElements:function(){this.assignElementsLock++,$(">li",this.view.sections).length>a&&Compozr.startProgress(0,2*$(">li",this.view.sections).length,this.resources.assignElementsProgress),
this._super();var e=this;Compozr.queueTask("setSections",function(){e.view.setSections(e.model.Sections)},function(){return 0===e.view.assignElementsLock}),Compozr.queueTask("finishAssignElements",function(){$(">li",e.view.sections).length>a&&Compozr.endProgress(),e.assignElementsLock--},function(){return 0===e.view.setSectionsLock})},enableElementsEditability:function(e){this.enableElementsEditabilityLock++,e||this._super();var t=this;this.enableSectionsEditabilityAsync($(">li",this.view.sections),function(){t.enableElementsEditabilityLock--},e)},disableElementsEditability:function(e){this.disableElementsEditabilityLock++,e||this._super();var t=this;this.disableSectionsEditabilityAsync($(">li",this.view.sections),function(){t.disableElementsEditabilityLock--},e)},enableSectionsEditabilityAsync:function(t,r,l){var c=this,d=t.slice(0,a),u=t.not(d);if(!l){var p=$("."+o,d).add($("."+i,d));p.attr(Compozr.CONTENTEDITABLE,"true").not("."+i).attr(Compozr.SINGLE_LINE,"").attr(Compozr.NO_HTML,"").attr(Compozr.SELECT_ON_FOCUS,"")}if(!this.view.isCompactMode()){var m=$("."+n,d);Compozr.includeAllInputs(m.children("input")),m.children("input").select2({width:"100%",placeholder:"["+this.resources.tags+"]",multiple:!0,query:function(e){Compozr.getJSON(c.options.searchSectionTagsUrl,{data:{term:e.term},onSuccess:function(t){$.each(t.models,function(e,o){t.models[e]={id:o.Key,text:o.Text}}),e.callback({results:t.models})}})},initSelection:function(e,t){var o=$(e).val();""!==o&&Compozr.getJSON(c.options.findSectionTagsUrl,{data:{keys:o},onSuccess:function(e){$.each(e.models,function(t,o){e.models[t]={id:o.Key,text:o.Text}}),t(e.models)}})}}).on("select2-focus"+e,function(){Compozr.fixSizeViewport(),$(this).closest("li").find("."+s).append(c.view.toolbox.show()),c.view.refreshToolbox()}).on("select2-blur"+e,function(){Compozr.restoreViewport()})}Compozr.increaseProgress(d.length,this.resources.enableElementsEditabilityProgress),u.length>0?window.setTimeout(function(){c.enableSectionsEditabilityAsync(u,r,l)},10):r()},disableSectionsEditabilityAsync:function(t,s,r){var l=this,c=t.slice(0,a),d=t.not(c);if(!r){var u=$("."+o,c).add($("."+i,c));u.removeAttr(Compozr.CONTENTEDITABLE)}if(!this.view.isCompactMode()){var p=$("."+n,c);$.each(p.children("input").off(e),function(e,t){$(t).select2("destroy").removeAttr("style")})}Compozr.increaseProgress(c.length,this.resources.disableElementsEditabilityProgress),d.length>0?window.setTimeout(function(){l.disableSectionsEditabilityAsync(d,s,r)},10):s()},finishInsertSection:function(e){this.view.assignSectionsElements(e),this.view.prepareSectionsEditor(e),this.enableSectionsEditabilityAsync(e,function(){},!1),Compozr.attachEditorEvents(e),$("."+i,e).focus(),Compozr.dirty(!0)},increaseSectionNumber:function(e){var t=this.view.loadField($("."+o,e)),i=t.lastIndexOf(".")+1,n=parseInt(t.substr(i));return isNaN(n)?t:t.substr(0,i)+(n+1)}})}(),function(){"use strict";GG.namespace("GG.Gallery"),GG.Gallery.Resources=GG.PageCompozr.Resources.extend(GG.PageCompozr.PageImages.Resources).extend(GG.PageCompozr.MultiPage.Resources).extend({themeColor:null,priority:null,name:null,urlFriendlyName:null,urlFriendlyNameDescription:null,description:null,uploadCoverImage:null})}(),function(){"use strict";GG.namespace("GG.Gallery");var e=".gallery";GG.Gallery.Index=GG.Class.extend({options:{newAlbumUrl:null},init:function(t){this.options=$.extend(this.options,t);var o=this;$Compozr.on("init"+e,function(){o.initMenu()}),$Compozr.on("newDoc"+e,function(){o.onNewAlbum()})},onNewAlbum:function(){Compozr.postNew(this.options.newAlbumUrl,Compozr.menu.NewAlbum)},initMenu:function(){Compozr.menu.NewAlbum.on("click"+e,function(){Compozr.newDoc()})}})}(),function(){"use strict";GG.namespace("GG.Gallery"),GG.Gallery=$.extend(GG.Gallery,{DEFAULT_EVENT_DOMAIN:".gallery",COVER_IMAGE_UPLOAD_BUTTON_CSS_CLASS:"btn btn-lg btn-primary",COVER_IMAGE_UPLOAD_BUTTON_ICON_CSS_CLASS:"glyphicon glyphicon-picture"}),GG.Gallery.AlbumViewOptions=GG.PageCompozr.PageViewOptions.extend(GG.PageCompozr.PageImages.PageViewOptions).extend({coverImageListUrl:null,uploadCoverImageUrl:null,renameCoverImageUrl:null,deleteCoverImageUrl:null}),GG.Gallery.AlbumViewBase=GG.PageCompozr.PageView.extend(GG.PageCompozr.PageImages.PageView).extend(GG.PageCompozr.MultiPage.PageView).extend({options:new GG.Gallery.AlbumViewOptions,resources:new GG.Gallery.Resources,priority:$(),themeColor:$(),name:$(),nameEditor:$(),urlFriendlyName:$(),description:$(),coverImage:$(),images:$(),navigation:$(),init:function(e,t,o){this._super(e,t,o),this.page=$(".album",this.container),this.name=$(".album-name",this.page),this.description=$(".description",this.page),this.navigation=$(".navigation",this.page),this.hiddenOnEditMode=this.hiddenOnEditMode.add($(".social-network",this.container)).add(this.navigation)},assignElements:function(){this.assignElementsLock++,this._super();var e=this,t=$("ul",this.extraInfo),o=$("<div></div>");t.append($("<li></li>").addClass(GG.PageCompozr.EXPANDED_COLUMN_CSS_CLASS).append(this.urlFriendlyName=$("<div></div>"))),this.urlFriendlyName.after($("<span></span>").html(this.resources.urlFriendlyNameDescription)),t.append($("<li></li>").addClass(GG.PageCompozr.COLUMN_CSS_CLASS).append(this.priority=$("<div></div>"))),t.append($("<li></li>").addClass(GG.PageCompozr.ON_TWO_COLUMN_BREAK_CSS_CLASS).addClass(GG.PageCompozr.ON_THREE_COLUMN_BREAK_CSS_CLASS)),t.append($("<li></li>").addClass(GG.PageCompozr.COLUMN_CSS_CLASS).append(this.themeColor=$("<div></div>"))),this.themeColor.after(o),t.append($("<li></li>").addClass(GG.PageCompozr.EXPANDED_COLUMN_CSS_CLASS).append(this.coverImage=$("<div></div>"))),o.colorPicker({formatItem:function(e,t){e.css("background",t)}});{var i={listUrl:this.options.coverImageListUrl,uploadUrl:this.options.uploadCoverImageUrl,renameUrl:this.options.renameCoverImageUrl,deleteUrl:this.options.deleteCoverImageUrl,multiple:!1,formatUploadButton:function(){return $("<div></div>").addClass(GG.Gallery.COVER_IMAGE_UPLOAD_BUTTON_CSS_CLASS).append($("<span></span>").addClass(GG.Gallery.COVER_IMAGE_UPLOAD_BUTTON_ICON_CSS_CLASS)).append(" "+e.resources.uploadCoverImage)}};new GG.Components.RemoteFolder(this.coverImage,i)}this.assignElementsLock--},preparePageEditor:function(e){this.prepareDocEditorLock++,this._super(e);var t=this;this.nameEditor=$("<div></div>").html(this.name.first().text()),this.name.html("").filter(":visible").append(this.nameEditor),this.initPlaceHolder(this.priority,this.resources.priority,!0,!0),this.initPlaceHolder(this.themeColor,this.resources.themeColor,!1,!0),this.initPlaceHolder(this.nameEditor,this.resources.name,!0,!1),this.initPlaceHolder(this.urlFriendlyName,this.resources.urlFriendlyName,!0,!1),this.initPlaceHolder(this.description,this.resources.description,!1,!1),this.description.css("min-height","200px"),this.themeColor.next().on("select.gg.colorPicker"+GG.Gallery.DEFAULT_EVENT_DOMAIN,function(e,o){t.themeColor.html()!==o&&(t.setField(t.themeColor,o),Compozr.dirty(!0)),$Compozr.triggerHandler("inputchange",t.themeColor)}),this.nameEditor.on("keyup"+GG.Gallery.DEFAULT_EVENT_DOMAIN,function(){var e=t.urlFriendlyName.html();t.urlFriendlyName.removeClass(GG.PageCompozr.PLACE_HOLDER_CSS_CLASS),t.urlFriendlyName.html(GG.toUrlFriendly(t.nameEditor.text())),t.urlFriendlyName.html()!==e&&Compozr.dirty(!0)}),$(window).on("resize"+GG.Gallery.DEFAULT_EVENT_DOMAIN,function(){t.nameEditor.is(":visible")||t.name.filter(":visible").append(t.nameEditor)}),this.prepareDocEditorLock--},cleanupPageEditor:function(e){this.cleanupDocEditorLock++,this._super(e),this.themeColor.next().off(GG.Gallery.DEFAULT_EVENT_DOMAIN),$(window).off(GG.Gallery.DEFAULT_EVENT_DOMAIN),this.destroyPlaceHolder(this.priority,!0),this.destroyPlaceHolder(this.themeColor,!0),this.destroyPlaceHolder(this.nameEditor,!1),this.destroyPlaceHolder(this.urlFriendlyName,!1),this.destroyPlaceHolder(this.description,!1),this.name.html(this.nameEditor.text()),this.nameEditor=$(),this.cleanupDocEditorLock--},loadPageModel:function(){var e=this._super();return $.extend(e,{Priority:this.loadField(this.priority),ThemeColorHtml:this.loadField(this.themeColor),"Localizations[0].Name":this.loadField(this.nameEditor.is("*")?this.nameEditor:this.name.first()),"Localizations[0].UrlFriendlyName":this.loadField(this.urlFriendlyName),"Localizations[0].Description":this.loadField(this.description,!0)})},updateImages:function(){var e=this;this.images.hide().removeAttr("data-ride").data("jqXHR",Compozr.getJSON(this.options.imageListUrl,{onSuccess:function(t,o,i){i===e.images.data("jqXHR")&&e.populateImages(t.items)},onComplete:function(t,o){t===e.images.data("jqXHR")&&e.images.removeData("jqXHR")}}))},populateImages:function(e){}})}(),function(){"use strict";GG.namespace("GG.Gallery"),GG.Gallery.SlidesAlbumView=GG.Gallery.AlbumViewBase.extend({imagesIndicatorTemplate:null,imagesItemTemplate:null,init:function(e,t,o){this._super(e,t,o),this.images=$("#images",this.page),this.hiddenOnEditMode=this.hiddenOnEditMode.add(this.images)},assignElements:function(){this.assignElementsLock++,this._super(),this.imagesIndicatorTemplate=$("template.images-indicator",Compozr.container).html(),this.imagesItemTemplate=$("template.images-item",Compozr.container).html(),this.assignElementsLock--},preparePageEditor:function(e){this.prepareDocEditorLock++,this._super(e);var t=this;$Compozr.on("inputchange"+GG.Gallery.DEFAULT_EVENT_DOMAIN,function(e,o){$(o).is(t.themeColor)&&(""===t.themeColor.text()?(t.name.css("color",""),$(".carousel-control",t.images).css("color","")):(t.name.css("color",t.themeColor.html()),$(".carousel-control",t.images).css("color",t.themeColor.html())))}),this.prepareDocEditorLock--},cleanupPageEditor:function(e){this.cleanupDocEditorLock++,this._super(e),$Compozr.off("inputchange"+GG.Gallery.DEFAULT_EVENT_DOMAIN),this.cleanupDocEditorLock--},populateImages:function(e){var t=this,o=$(".carousel-indicators",t.images).html(""),i=$(".carousel-inner",t.images).html("");$.each(e,function(e,n){var s=$(t.imagesIndicatorTemplate);s.attr("data-slide-to",e),0===e&&s.addClass("active"),$("span",s).css("background-image","url("+n.thumbUrl+")"),o.append(s).append(" ");var a=$(t.imagesItemTemplate);$("img",a).attr("src",n.url),0===e&&a.addClass("active"),i.append(a)}),e.length>0&&t.images.show().carousel().data("gg.autoCarouselHeight").init()}})}(),function(){"use strict";GG.namespace("GG.Gallery"),GG.Gallery.PhotostreamAlbumView=GG.Gallery.AlbumViewBase.extend({imagesItemTemplate:null,init:function(e,t,o){this._super(e,t,o),this.images=$(".images",this.page),this.hiddenOnEditMode=this.hiddenOnEditMode.add(this.images)},assignElements:function(){this.assignElementsLock++,this._super(),this.imagesItemTemplate=$("template.images-item",Compozr.container).html(),this.assignElementsLock--},populateImages:function(e){var t=this;$("img[src]",this.images).remove(),$.each(e,function(e,o){var i=$(t.imagesItemTemplate),n=o.fileName.substring(0,o.fileName.lastIndexOf("."));i.attr({src:o.url,"data-name":n,"data-width":o.width,"data-height":o.height}),t.images.append(i)}),e.length>0&&(t.images.show(),$(window).resize(),$("img[src]",this.images).on("load",function(){$(window).resize()}))}})}(),function(){"use strict";GG.namespace("GG.Gallery");var e=new Compozr.HtmlEditorToolbar;GG.Gallery.AlbumModel=GG.PageCompozr.PageModel.extend(GG.PageCompozr.MultiPage.PageModel).extend({Priority:null,ThemeColor:null,Name:null,UrlFriendlyName:null}),GG.Gallery.AlbumControllerOptions=GG.PageCompozr.PageModel.extend(GG.PageCompozr.MultiPage.PageControllerOptions),GG.Gallery.AlbumController=GG.PageCompozr.PageController.extend(GG.PageCompozr.PageImages.PageController).extend(GG.PageCompozr.MultiPage.PageController).extend({view:new GG.Gallery.AlbumViewBase,options:new GG.Gallery.AlbumControllerOptions,model:new GG.Gallery.AlbumModel,resources:new GG.Gallery.Resources,init:function(t,o,i,n){this._super(t,o,i,n),this.view.options.coverImageListUrl+="/"+this.model.Id,this.view.options.uploadCoverImageUrl+="/"+this.model.Id,this.view.options.renameCoverImageUrl+="/"+this.model.Id,this.view.options.deleteCoverImageUrl+="/"+this.model.Id;var s=this;$Compozr.on("init"+GG.Gallery.DEFAULT_EVENT_DOMAIN,function(t,o){e=new Compozr.HtmlEditorToolbar(Compozr.container,{pasteDescription:"paste"}),e.hide()}),$Compozr.on("save"+GG.Gallery.DEFAULT_EVENT_DOMAIN,function(e,t){t.ThemeColor=t.ThmeColorHtml,t.Name=t["Localizations[0].Name"],t.UrlFriendlyName=t["Localizations[0].UrlFriendlyName"],t.Description=t["Localizations[0].Description"],delete t.ThmeColorHtml,delete t["Localizations[0].Name"],delete t["Localizations[0].UrlFriendlyName"],delete t["Localizations[0].Description"],t.UrlFriendlyName!==s.model.UrlFriendlyName&&(Compozr.cancelTask("redirectByUrlFriendlyName"),Compozr.queueTask("redirectByUrlFriendlyName",function(){Compozr.dirty(!1),window.location=s.options.pageUrl+"/"+t.UrlFriendlyName},function(){return!Compozr.menu.TogglePage.data("jqXHR")}))})},switchToEditMode:function(){e.show(),this._super()},switchToPreviewMode:function(){e.hide(),this._super();var t=this;Compozr.queueTask("finishSwitchToPreviewMode",function(){t.view.updateImages()},function(){return 0===t.view.cleanupPageEditorLock})},backupInitialData:function(){this._super(),this.model=$.extend(this.model,{Name:this.view.name.html(),Description:this.view.description.html()})},restoreData:function(){this._super(),this.view.priority.html(this.model.Priority),this.view.themeColor.html(this.model.ThemeColor),this.view.name.html(this.model.Name),this.view.urlFriendlyName.html(this.model.UrlFriendlyName),this.view.description.html(this.model.Description)},assignElements:function(){this.assignElementsLock++,this._super();var e=this;Compozr.queueTask("finishAssignElements",function(){e.view.priority.html(e.model.Priority),e.view.themeColor.html(e.model.ThemeColor),e.view.urlFriendlyName.html(e.model.UrlFriendlyName),e.assignElementsLock--},function(){return 0===e.view.assignElementsLock})},enableElementsEditability:function(){this.enableElementsEditabilityLock++,this._super();var e=this.view.priority.add(this.view.themeColor).add(this.view.nameEditor).add(this.view.urlFriendlyName).add(this.view.description);e.attr(Compozr.CONTENTEDITABLE,"true").not(this.view.description).attr(Compozr.SINGLE_LINE,"").attr(Compozr.NO_HTML,"").attr(Compozr.SELECT_ON_FOCUS,""),this.view.urlFriendlyName.attr(Compozr.URL_FRIENDLY,""),this.options.editMode&&this.view.description.attr(Compozr.SELECT_ON_FIRST_FOCUS,""),this.enableElementsEditabilityLock--},disableElementsEditability:function(){this.disableElementsEditabilityLock++,this._super();var e=this.view.priority.add(this.view.themeColor).add(this.view.nameEditor).add(this.view.urlFriendlyName).add(this.view.description);e.removeAttr(Compozr.CONTENTEDITABLE),this.disableElementsEditabilityLock--}})}();